<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Rhonabwy: Rhonabwy API documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Rhonabwy
   </div>
   <div id="projectbrief">Javascript Object Signing and Encryption (JOSE) library - JWK, JWKS, JWS, JWE and JWT</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Rhonabwy API documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_API"></a> Rhonabwy library is made to manage JWK, JWKS, JWS, JWE and JWT according to their respective RFCs:</p>
<ul>
<li><a href="https://tools.ietf.org/html/rfc7517">JSON Web Keys</a> (JWK) and JSON Web Keys Set (JWKS)</li>
<li><a href="https://tools.ietf.org/html/rfc7515">JSON Web Signatures</a> (JWS)</li>
<li><a href="https://tools.ietf.org/html/rfc7516">JSON Web Encryption</a> (JWE)</li>
<li><a href="https://tools.ietf.org/html/rfc7519">JSON Web Token</a> (JWT)</li>
</ul>
<p>Rhonabwy is based on the following libraries and actively uses them:</p>
<ul>
<li>GnuTLS for the cryptographic functions</li>
<li>Jansson for the JSON manipulation</li>
<li>Yder for the logs</li>
<li>Libcurl when it requires to retrieve keys from an URL</li>
</ul>
<p>When relevant, a function can accept or return GnuTLS or Jansson data. But if you're not using those in your application and prefer raw data, you can use the more agnostic functions.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Return values</h1>
<p>Lots of functions in Rhonabwy library return an int value. The returned value can be one of the following:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define RHN_OK                 0</span></div>
<div class="line"><span class="preprocessor">#define RHN_ERROR              1</span></div>
<div class="line"><span class="preprocessor">#define RHN_ERROR_MEMORY       2</span></div>
<div class="line"><span class="preprocessor">#define RHN_ERROR_PARAM        3</span></div>
<div class="line"><span class="preprocessor">#define RHN_ERROR_UNSUPPORTED  4</span></div>
<div class="line"><span class="preprocessor">#define RHN_ERROR_INVALID      5</span></div>
</div><!-- fragment --><p>If a function is successful, it will return <code>RHN_OK</code> (0), otherwise an error code is returned.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Global init and close</h1>
<p>It's <b>recommended</b> to use <code>r_global_init</code> and <code>r_global_close</code> at the beginning and at the end of your program to initialize and cleanup internal values and settings. This will make outgoing requests faster, especially if you use lots of them, and dispatch your memory allocation functions in curl and Jansson if you changed them. These functions are <b>NOT</b> thread-safe, so you must use them in a single thread context.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#gabfc12879795ad651086cda271c7183f3">r_global_init</a>(<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#gab7e42de8af536df2a2ebe19be669aa7b">r_global_close</a>(<span class="keywordtype">void</span>);</div>
<div class="ttc" id="agroup__core_html_gab7e42de8af536df2a2ebe19be669aa7b"><div class="ttname"><a href="group__core.html#gab7e42de8af536df2a2ebe19be669aa7b">r_global_close</a></div><div class="ttdeci">void r_global_close(void)</div><div class="ttdef"><b>Definition:</b> misc.c:59</div></div>
<div class="ttc" id="agroup__core_html_gabfc12879795ad651086cda271c7183f3"><div class="ttname"><a href="group__core.html#gabfc12879795ad651086cda271c7183f3">r_global_init</a></div><div class="ttdeci">int r_global_init(void)</div><div class="ttdef"><b>Definition:</b> misc.c:37</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3"></a>
Log messages</h1>
<p>Usually, a log message is displayed to explain more specifically what happened on error. The log manager used is <a href="https://github.com/babelouest/yder">Yder</a>. You can enable Yder log messages on the console with the following command at the beginning of your program:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {</div>
<div class="line">  y_init_logs(<span class="stringliteral">&quot;Rhonabwy&quot;</span>, Y_LOG_MODE_CONSOLE, Y_LOG_LEVEL_DEBUG, NULL, <span class="stringliteral">&quot;Starting Rhonabwy client program&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Do your code here</span></div>
<div class="line">  </div>
<div class="line">  y_close_logs();</div>
<div class="line">}</div>
</div><!-- fragment --><p>Example of an error log message:</p>
<div class="fragment"><div class="line">2020-04-05T16:14:31 - Rhonabwy: r_jwk_is_valid - Invalid alg</div>
</div><!-- fragment --><p>Go to Yder <a href="https://babelouest.github.io/yder/">API Documentation</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Memory management</h1>
<p>All typedefs managed by Rhonabwy use dedicated init and free functions. You must always use those functions to allocate or free resources manipulated by the library.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> ** jwk);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#ga6d62f61c18adafd2faec28c3e76bfc7b">r_jwks_init</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> ** jwks);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#ga6035f53cdffed4076b5d085e8172025f">r_jwks_free</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> * jwks);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#ga365c9ed016d8034d1bc5a00b686c859b">r_jws_init</a>(<a class="code" href="structjws__t.html">jws_t</a> ** jws);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#ga4f008bda5b951380b6eaa99d35779d64">r_jws_free</a>(<a class="code" href="structjws__t.html">jws_t</a> * jws);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#ga9fe136eb9a9a8c256f4cdb091c14da52">r_jwe_init</a>(<a class="code" href="structjwe__t.html">jwe_t</a> ** jwe);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#ga14172c6cf13d0e96abf27d660d87037b">r_jwe_free</a>(<a class="code" href="structjwe__t.html">jwe_t</a> * jwe);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__core.html#gad5d9ca3960b9bf0c07dc1c1cbc8680c2">r_jwt_init</a>(<a class="code" href="structjwt__t.html">jwt_t</a> ** jwt);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#ga676cff4810db612ac0047c57ff5eff87">r_jwt_free</a>(<a class="code" href="structjwt__t.html">jwt_t</a> * jwt);</div>
<div class="ttc" id="agroup__core_html_ga14172c6cf13d0e96abf27d660d87037b"><div class="ttname"><a href="group__core.html#ga14172c6cf13d0e96abf27d660d87037b">r_jwe_free</a></div><div class="ttdeci">void r_jwe_free(jwe_t *jwe)</div><div class="ttdef"><b>Definition:</b> jwe.c:2737</div></div>
<div class="ttc" id="agroup__core_html_ga365c9ed016d8034d1bc5a00b686c859b"><div class="ttname"><a href="group__core.html#ga365c9ed016d8034d1bc5a00b686c859b">r_jws_init</a></div><div class="ttdeci">int r_jws_init(jws_t **jws)</div><div class="ttdef"><b>Definition:</b> jws.c:845</div></div>
<div class="ttc" id="agroup__core_html_ga4f008bda5b951380b6eaa99d35779d64"><div class="ttname"><a href="group__core.html#ga4f008bda5b951380b6eaa99d35779d64">r_jws_free</a></div><div class="ttdeci">void r_jws_free(jws_t *jws)</div><div class="ttdef"><b>Definition:</b> jws.c:888</div></div>
<div class="ttc" id="agroup__core_html_ga5132358e821050897ea7e65b0a6e324b"><div class="ttname"><a href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a></div><div class="ttdeci">void r_jwk_free(jwk_t *jwk)</div><div class="ttdef"><b>Definition:</b> jwk.c:57</div></div>
<div class="ttc" id="agroup__core_html_ga6035f53cdffed4076b5d085e8172025f"><div class="ttname"><a href="group__core.html#ga6035f53cdffed4076b5d085e8172025f">r_jwks_free</a></div><div class="ttdeci">void r_jwks_free(jwks_t *jwks)</div><div class="ttdef"><b>Definition:</b> jwks.c:41</div></div>
<div class="ttc" id="agroup__core_html_ga676cff4810db612ac0047c57ff5eff87"><div class="ttname"><a href="group__core.html#ga676cff4810db612ac0047c57ff5eff87">r_jwt_free</a></div><div class="ttdeci">void r_jwt_free(jwt_t *jwt)</div><div class="ttdef"><b>Definition:</b> jwt.c:95</div></div>
<div class="ttc" id="agroup__core_html_ga6d62f61c18adafd2faec28c3e76bfc7b"><div class="ttname"><a href="group__core.html#ga6d62f61c18adafd2faec28c3e76bfc7b">r_jwks_init</a></div><div class="ttdeci">int r_jwks_init(jwks_t **jwks)</div><div class="ttdef"><b>Definition:</b> jwks.c:30</div></div>
<div class="ttc" id="agroup__core_html_ga9fe136eb9a9a8c256f4cdb091c14da52"><div class="ttname"><a href="group__core.html#ga9fe136eb9a9a8c256f4cdb091c14da52">r_jwe_init</a></div><div class="ttdeci">int r_jwe_init(jwe_t **jwe)</div><div class="ttdef"><b>Definition:</b> jwe.c:2683</div></div>
<div class="ttc" id="agroup__core_html_gad5d9ca3960b9bf0c07dc1c1cbc8680c2"><div class="ttname"><a href="group__core.html#gad5d9ca3960b9bf0c07dc1c1cbc8680c2">r_jwt_init</a></div><div class="ttdeci">int r_jwt_init(jwt_t **jwt)</div><div class="ttdef"><b>Definition:</b> jwt.c:34</div></div>
<div class="ttc" id="agroup__core_html_gaf6734cc4f9ab69d875ff86d60aee3c06"><div class="ttname"><a href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a></div><div class="ttdeci">int r_jwk_init(jwk_t **jwk)</div><div class="ttdef"><b>Definition:</b> jwk.c:46</div></div>
<div class="ttc" id="agroup__type_html_gac7d996dfabdc443bcd0da0b6574e22ef"><div class="ttname"><a href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a></div><div class="ttdeci">json_t jwk_t</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:111</div></div>
<div class="ttc" id="agroup__type_html_gad1e7e9d151ac27e89f550389ee397494"><div class="ttname"><a href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a></div><div class="ttdeci">json_t jwks_t</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:112</div></div>
<div class="ttc" id="astructjwe__t_html"><div class="ttname"><a href="structjwe__t.html">jwe_t</a></div><div class="ttdef"><b>Definition:</b> rhonabwy.h:257</div></div>
<div class="ttc" id="astructjws__t_html"><div class="ttname"><a href="structjws__t.html">jws_t</a></div><div class="ttdef"><b>Definition:</b> rhonabwy.h:243</div></div>
<div class="ttc" id="astructjwt__t_html"><div class="ttname"><a href="structjwt__t.html">jwt_t</a></div><div class="ttdef"><b>Definition:</b> rhonabwy.h:282</div></div>
</div><!-- fragment --><p>In addition, when a function return a <code>char *</code> value, this value must be freed using the function <code><a class="el" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free(void *)</a></code>.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a>(<span class="keywordtype">void</span> * data);</div>
<div class="ttc" id="agroup__core_html_gab04b1ac2dfe5a33b0aae918f9d17b359"><div class="ttname"><a href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a></div><div class="ttdeci">void r_free(void *data)</div><div class="ttdef"><b>Definition:</b> misc.c:713</div></div>
</div><!-- fragment --><p>And finally, all <code>json_t *</code> returned values must be de allocated using <code>json_decref(json_t *)</code>, see <a href="https://jansson.readthedocs.io/">Jansson Documentation</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Library information</h1>
<p>The functions <code><a class="el" href="group__core.html#gae67b491df674a34853763b82f74eebec">r_library_info_json_t()</a></code> and <code><a class="el" href="group__core.html#ga0a4f678e06089fce626afc4339b04aa6">r_library_info_json_str()</a></code> return a JSON object that represents the signature and encryption algorithms supported, as well as the library version.</p>
<p>Example output:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;version&quot;: &quot;0.9.9999&quot;,</div>
<div class="line">  &quot;jws&quot;: {</div>
<div class="line">    &quot;alg&quot;: [</div>
<div class="line">      &quot;none&quot;,</div>
<div class="line">      &quot;HS256&quot;,</div>
<div class="line">      &quot;HS384&quot;,</div>
<div class="line">      &quot;HS512&quot;,</div>
<div class="line">      &quot;RS256&quot;,</div>
<div class="line">      &quot;RS384&quot;,</div>
<div class="line">      &quot;RS512&quot;,</div>
<div class="line">      &quot;ES256&quot;,</div>
<div class="line">      &quot;ES384&quot;,</div>
<div class="line">      &quot;ES512&quot;,</div>
<div class="line">      &quot;EdDSA&quot;,</div>
<div class="line">      &quot;PS256&quot;,</div>
<div class="line">      &quot;PS384&quot;,</div>
<div class="line">      &quot;PS512&quot;</div>
<div class="line">    ]</div>
<div class="line">  },</div>
<div class="line">  &quot;jwe&quot;: {</div>
<div class="line">    &quot;alg&quot;: [</div>
<div class="line">      &quot;RSA1_5&quot;,</div>
<div class="line">      &quot;RSA-OAEP&quot;,</div>
<div class="line">      &quot;RSA-OAEP-256&quot;,</div>
<div class="line">      &quot;A128KW&quot;,</div>
<div class="line">      &quot;A192KW&quot;,</div>
<div class="line">      &quot;A256KW&quot;,</div>
<div class="line">      &quot;dir&quot;,</div>
<div class="line">      &quot;A128GCMKW&quot;,</div>
<div class="line">      &quot;A192GCMKW&quot;,</div>
<div class="line">      &quot;A256GCMKW&quot;,</div>
<div class="line">      &quot;PBES2-HS256+A128KW&quot;,</div>
<div class="line">      &quot;PBES2-HS384+A192KW&quot;,</div>
<div class="line">      &quot;PBES2-HS512+A256KW&quot;,</div>
<div class="line">      &quot;ECDH-ES&quot;,</div>
<div class="line">      &quot;ECDH-ES+A128KW&quot;,</div>
<div class="line">      &quot;ECDH-ES+A192KW&quot;,</div>
<div class="line">      &quot;ECDH-ES+A256KW&quot;</div>
<div class="line">    ],</div>
<div class="line">    &quot;enc&quot;: [</div>
<div class="line">      &quot;A128CBC-HS256&quot;,</div>
<div class="line">      &quot;A192CBC-HS384&quot;,</div>
<div class="line">      &quot;A256CBC-HS512&quot;,</div>
<div class="line">      &quot;A128GCM&quot;,</div>
<div class="line">      &quot;A256GCM&quot;,</div>
<div class="line">      &quot;A192GCM&quot;</div>
<div class="line">    ]</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md6"></a>
Header or Claim integer value</h1>
<p>When using <code>r_jws_set_header_int_value</code>, <code>r_jwe_set_header_int_value</code>, <code>r_jwt_set_header_int_value</code> or <code>r_jwt_set_claim_int_value</code>, the int value must be of type <code>rhn_int_t</code>, which inner format depend on the architecture. It's recommended not to use an <code>int</code> instead, or undefined behaviour may happen.</p>
<p>Likewise, the functions <code>r_jws_get_header_int_value</code>, <code>r_jwe_get_header_int_value</code>, <code>r_jwt_get_header_int_value</code> or <code>r_jwt_get_claim_int_value</code>, these functions will return a <code>rhn_int_t</code>.</p>
<p>To use a <code>rhn_int_t</code> in a printf-like function, you can use the macro <code>RHONABWY_INTEGER_FORMAT</code>:</p>
<div class="fragment"><div class="line"><a class="code" href="group__type.html#ga6757151c907d670d38e412e623c0309b">rhn_int_t</a> val = 42;</div>
<div class="line">printf(<span class="stringliteral">&quot;value: %&quot;</span><a class="code" href="group__type.html#ga1e2e24586ed46d6ce8b43cf52c929ffb">RHONABWY_INTEGER_FORMAT</a><span class="stringliteral">&quot;\n&quot;</span>, val);</div>
<div class="ttc" id="agroup__type_html_ga1e2e24586ed46d6ce8b43cf52c929ffb"><div class="ttname"><a href="group__type.html#ga1e2e24586ed46d6ce8b43cf52c929ffb">RHONABWY_INTEGER_FORMAT</a></div><div class="ttdeci">#define RHONABWY_INTEGER_FORMAT</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:115</div></div>
<div class="ttc" id="agroup__type_html_ga6757151c907d670d38e412e623c0309b"><div class="ttname"><a href="group__type.html#ga6757151c907d670d38e412e623c0309b">rhn_int_t</a></div><div class="ttdeci">json_int_t rhn_int_t</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:113</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
JWK</h1>
<p>A JWK (JSON Web Key) is a format used to store and represent a cryptographic key in a JSON object.</p>
<p>Example of JWK:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;kty&quot;:&quot;EC&quot;,</div>
<div class="line">  &quot;crv&quot;:&quot;P-256&quot;,</div>
<div class="line">  &quot;x&quot;:&quot;f83OJ3D2xF1Bg8vub9tLe1gHMzV76e8Tus9uPHvRVEU&quot;,</div>
<div class="line">  &quot;y&quot;:&quot;x_FEzRu9m36HLN_tue659LNpXW6pCyStikYjKIWI5a0&quot;,</div>
<div class="line">  &quot;kid&quot;:&quot;Public key used in JWS spec Appendix A.3 example&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The standard allows to store public and private keys for RSA and ECC algorithms, it also allows to store symmetric keys. In a JWK, every raw value is encoded in Base64Url format to fit in the JSON object without any issue.</p>
<p>A JWK is represented in Rhonabwy library using the type <code>jwk_t *</code>.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Import and Export JWK</h2>
<p>Rhonabwy allows to import and export a JWK in the following formats:</p><ul>
<li>A JSON structure in a <code>const char *</code></li>
<li>A JSON structure in a <code>json_t *</code></li>
<li>A key or certificate in <code>PEM</code> or <code>DER</code> format</li>
<li>A <code>GnuTLS</code> structure of the following: <code>gnutls_privkey_t</code>, <code>gnutls_pubkey_t</code> or <code>gnutls_x509_crt_t</code> (import only)</li>
</ul>
<p>If the imported JWK contains a <code>x5u</code> property, the key or certificate will be downloaded at the given address. If so, you can give an additional parameter <code>x5u_flag</code> which values can be:</p><ul>
<li><code>R_FLAG_IGNORE_SERVER_CERTIFICATE</code>: ignore if web server certificate is invalid</li>
<li><code>R_FLAG_FOLLOW_REDIRECT</code>: follow redirection if necessary</li>
<li><code>R_FLAG_IGNORE_REMOTE</code>: do not download remote key, but the function may return an error</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * input);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__import.html#ga5994393515038f59702c68261b07c5ca">r_jwk_import_from_json_t</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, json_t * j_input);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__import.html#ga1b29d9082217157bcd58e68dab16f513">r_jwk_import_from_pem_der</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> format, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * input, <span class="keywordtype">size_t</span> input_len);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__import.html#gaf9116d258a7a8391003e4c3e107d859d">r_jwk_import_from_gnutls_privkey</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, gnutls_privkey_t key);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__import.html#ga9501f98c61a2c15ba6eb5a0c1963c8f6">r_jwk_import_from_gnutls_pubkey</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, gnutls_pubkey_t pub);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__import.html#ga79cd34a22fa17847082410e413ff9be8">r_jwk_import_from_gnutls_x509_crt</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, gnutls_x509_crt_t crt);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__import.html#gaea7fb56daaac4f67e26c9a3fa29e73e0">r_jwk_import_from_x5u</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keywordtype">int</span> x5u_flags, <span class="keyword">const</span> <span class="keywordtype">char</span> * x5u);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__import.html#ga8e3ad1be8235158fb12a1958f63ebbe9">r_jwk_import_from_x5c</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * x5c);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__import.html#ga7c1d69c5db756215249054a7a659f612">r_jwk_import_from_symmetric_key</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * key, <span class="keywordtype">size_t</span> key_len);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__import.html#ga09d060c7cd4cbdbd81d4e8ddf2f02e1a">r_jwk_import_from_password</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * password);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__import.html#gac76ba127a4eadcb2122abeb0d49814c3">r_jwk_extract_pubkey</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_privkey, <a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_pubkey, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * <a class="code" href="group__import.html#ga44fa1b37eb402aefe9cf7dd3fb8fbd1d">r_jwk_quick_import</a>(<a class="code" href="group__type.html#ga7ac7039b8e1cc414d3da273c244ed591">rhn_import</a> type, ...);</div>
<div class="ttc" id="agroup__import_html_ga09d060c7cd4cbdbd81d4e8ddf2f02e1a"><div class="ttname"><a href="group__import.html#ga09d060c7cd4cbdbd81d4e8ddf2f02e1a">r_jwk_import_from_password</a></div><div class="ttdeci">int r_jwk_import_from_password(jwk_t *jwk, const char *password)</div><div class="ttdef"><b>Definition:</b> jwk.c:1678</div></div>
<div class="ttc" id="agroup__import_html_ga19c4a32dc17dc0c11a452b177c83b1aa"><div class="ttname"><a href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a></div><div class="ttdeci">int r_jwk_import_from_json_str(jwk_t *jwk, const char *input)</div><div class="ttdef"><b>Definition:</b> jwk.c:885</div></div>
<div class="ttc" id="agroup__import_html_ga1b29d9082217157bcd58e68dab16f513"><div class="ttname"><a href="group__import.html#ga1b29d9082217157bcd58e68dab16f513">r_jwk_import_from_pem_der</a></div><div class="ttdeci">int r_jwk_import_from_pem_der(jwk_t *jwk, int type, int format, const unsigned char *input, size_t input_len)</div><div class="ttdef"><b>Definition:</b> jwk.c:918</div></div>
<div class="ttc" id="agroup__import_html_ga44fa1b37eb402aefe9cf7dd3fb8fbd1d"><div class="ttname"><a href="group__import.html#ga44fa1b37eb402aefe9cf7dd3fb8fbd1d">r_jwk_quick_import</a></div><div class="ttdeci">jwk_t * r_jwk_quick_import(rhn_import type,...)</div><div class="ttdef"><b>Definition:</b> jwk.c:1682</div></div>
<div class="ttc" id="agroup__import_html_ga5994393515038f59702c68261b07c5ca"><div class="ttname"><a href="group__import.html#ga5994393515038f59702c68261b07c5ca">r_jwk_import_from_json_t</a></div><div class="ttdeci">int r_jwk_import_from_json_t(jwk_t *jwk, json_t *j_input)</div><div class="ttdef"><b>Definition:</b> jwk.c:902</div></div>
<div class="ttc" id="agroup__import_html_ga79cd34a22fa17847082410e413ff9be8"><div class="ttname"><a href="group__import.html#ga79cd34a22fa17847082410e413ff9be8">r_jwk_import_from_gnutls_x509_crt</a></div><div class="ttdeci">int r_jwk_import_from_gnutls_x509_crt(jwk_t *jwk, gnutls_x509_crt_t crt)</div><div class="ttdef"><b>Definition:</b> jwk.c:1573</div></div>
<div class="ttc" id="agroup__import_html_ga7c1d69c5db756215249054a7a659f612"><div class="ttname"><a href="group__import.html#ga7c1d69c5db756215249054a7a659f612">r_jwk_import_from_symmetric_key</a></div><div class="ttdeci">int r_jwk_import_from_symmetric_key(jwk_t *jwk, const unsigned char *key, size_t key_len)</div><div class="ttdef"><b>Definition:</b> jwk.c:1653</div></div>
<div class="ttc" id="agroup__import_html_ga8e3ad1be8235158fb12a1958f63ebbe9"><div class="ttname"><a href="group__import.html#ga8e3ad1be8235158fb12a1958f63ebbe9">r_jwk_import_from_x5c</a></div><div class="ttdeci">int r_jwk_import_from_x5c(jwk_t *jwk, const char *x5c)</div><div class="ttdef"><b>Definition:</b> jwk.c:1631</div></div>
<div class="ttc" id="agroup__import_html_ga9501f98c61a2c15ba6eb5a0c1963c8f6"><div class="ttname"><a href="group__import.html#ga9501f98c61a2c15ba6eb5a0c1963c8f6">r_jwk_import_from_gnutls_pubkey</a></div><div class="ttdeci">int r_jwk_import_from_gnutls_pubkey(jwk_t *jwk, gnutls_pubkey_t pub)</div><div class="ttdef"><b>Definition:</b> jwk.c:1360</div></div>
<div class="ttc" id="agroup__import_html_gac76ba127a4eadcb2122abeb0d49814c3"><div class="ttname"><a href="group__import.html#gac76ba127a4eadcb2122abeb0d49814c3">r_jwk_extract_pubkey</a></div><div class="ttdeci">int r_jwk_extract_pubkey(jwk_t *jwk_privkey, jwk_t *jwk_pubkey, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwk.c:834</div></div>
<div class="ttc" id="agroup__import_html_gaea7fb56daaac4f67e26c9a3fa29e73e0"><div class="ttname"><a href="group__import.html#gaea7fb56daaac4f67e26c9a3fa29e73e0">r_jwk_import_from_x5u</a></div><div class="ttdeci">int r_jwk_import_from_x5u(jwk_t *jwk, int x5u_flags, const char *x5u)</div><div class="ttdef"><b>Definition:</b> jwk.c:1609</div></div>
<div class="ttc" id="agroup__import_html_gaf9116d258a7a8391003e4c3e107d859d"><div class="ttname"><a href="group__import.html#gaf9116d258a7a8391003e4c3e107d859d">r_jwk_import_from_gnutls_privkey</a></div><div class="ttdeci">int r_jwk_import_from_gnutls_privkey(jwk_t *jwk, gnutls_privkey_t key)</div><div class="ttdef"><b>Definition:</b> jwk.c:1047</div></div>
<div class="ttc" id="agroup__type_html_ga7ac7039b8e1cc414d3da273c244ed591"><div class="ttname"><a href="group__type.html#ga7ac7039b8e1cc414d3da273c244ed591">rhn_import</a></div><div class="ttdeci">rhn_import</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:228</div></div>
</div><!-- fragment --><p>The values <code>R_FLAG_IGNORE_SERVER_CERTIFICATE</code> and <code>R_FLAG_FOLLOW_REDIRECT</code> can be merged: <code>R_FLAG_IGNORE_SERVER_CERTIFICATE|R_FLAG_FOLLOW_REDIRECT</code></p>
<h2><a class="anchor" id="autotoc_md9"></a>
Manipulate JWK properties</h2>
<p>You can manipulate the JWK properties directly using the dedicated functions:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="group__jwk__properties.html#ga4d0a505baa8e441a70490840fb880ee6">r_jwk_get_property_str</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="group__jwk__properties.html#gaf6cd637cf88d511d547a146e10d8bb0a">r_jwk_get_property_array</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keywordtype">size_t</span> index);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwk__properties.html#gae4caae9a7017e947f9ed9fd637926c76">r_jwk_set_property_str</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keyword">const</span> <span class="keywordtype">char</span> * value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwk__properties.html#ga36b7d9e1f3569efcef659e4b82c7355c">r_jwk_set_property_array</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keywordtype">size_t</span> index, <span class="keyword">const</span> <span class="keywordtype">char</span> * value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwk__properties.html#ga85b06a928093bcc8352f293ef5bf2450">r_jwk_append_property_array</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keyword">const</span> <span class="keywordtype">char</span> * value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwk__properties.html#ga572be5228d9f1302ef47c1f51de1ac8c">r_jwk_delete_property_str</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwk__properties.html#gafea3b8f0536a37bd4024d5ac76238016">r_jwk_delete_property_array_at</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keywordtype">size_t</span> index);</div>
<div class="ttc" id="agroup__jwk__properties_html_ga36b7d9e1f3569efcef659e4b82c7355c"><div class="ttname"><a href="group__jwk__properties.html#ga36b7d9e1f3569efcef659e4b82c7355c">r_jwk_set_property_array</a></div><div class="ttdeci">int r_jwk_set_property_array(jwk_t *jwk, const char *key, size_t index, const char *value)</div><div class="ttdef"><b>Definition:</b> jwk.c:2555</div></div>
<div class="ttc" id="agroup__jwk__properties_html_ga4d0a505baa8e441a70490840fb880ee6"><div class="ttname"><a href="group__jwk__properties.html#ga4d0a505baa8e441a70490840fb880ee6">r_jwk_get_property_str</a></div><div class="ttdeci">const char * r_jwk_get_property_str(jwk_t *jwk, const char *key)</div><div class="ttdef"><b>Definition:</b> jwk.c:2504</div></div>
<div class="ttc" id="agroup__jwk__properties_html_ga572be5228d9f1302ef47c1f51de1ac8c"><div class="ttname"><a href="group__jwk__properties.html#ga572be5228d9f1302ef47c1f51de1ac8c">r_jwk_delete_property_str</a></div><div class="ttdeci">int r_jwk_delete_property_str(jwk_t *jwk, const char *key)</div><div class="ttdef"><b>Definition:</b> jwk.c:2597</div></div>
<div class="ttc" id="agroup__jwk__properties_html_ga85b06a928093bcc8352f293ef5bf2450"><div class="ttname"><a href="group__jwk__properties.html#ga85b06a928093bcc8352f293ef5bf2450">r_jwk_append_property_array</a></div><div class="ttdeci">int r_jwk_append_property_array(jwk_t *jwk, const char *key, const char *value)</div><div class="ttdef"><b>Definition:</b> jwk.c:2579</div></div>
<div class="ttc" id="agroup__jwk__properties_html_gae4caae9a7017e947f9ed9fd637926c76"><div class="ttname"><a href="group__jwk__properties.html#gae4caae9a7017e947f9ed9fd637926c76">r_jwk_set_property_str</a></div><div class="ttdeci">int r_jwk_set_property_str(jwk_t *jwk, const char *key, const char *value)</div><div class="ttdef"><b>Definition:</b> jwk.c:2542</div></div>
<div class="ttc" id="agroup__jwk__properties_html_gaf6cd637cf88d511d547a146e10d8bb0a"><div class="ttname"><a href="group__jwk__properties.html#gaf6cd637cf88d511d547a146e10d8bb0a">r_jwk_get_property_array</a></div><div class="ttdeci">const char * r_jwk_get_property_array(jwk_t *jwk, const char *key, size_t index)</div><div class="ttdef"><b>Definition:</b> jwk.c:2516</div></div>
<div class="ttc" id="agroup__jwk__properties_html_gafea3b8f0536a37bd4024d5ac76238016"><div class="ttname"><a href="group__jwk__properties.html#gafea3b8f0536a37bd4024d5ac76238016">r_jwk_delete_property_array_at</a></div><div class="ttdeci">int r_jwk_delete_property_array_at(jwk_t *jwk, const char *key, size_t index)</div><div class="ttdef"><b>Definition:</b> jwk.c:2610</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md10"></a>
Validate the format of a JWK</h2>
<p>The function <code>r_jwk_is_valid</code> will check the validity of a JWK, i.e. check if all the required properties are present and in the correct format. Note that this function is called each time an import is made.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Generate a random key pair</h2>
<p>You can use Rhonabwy to generate a random key pair for RSA, ECC or OKP algorithms. The <code>jwk_t *</code> parameters must be initialized first.</p>
<p>The <code>type</code> parameter can have one of the following values: <code>R_KEY_TYPE_RSA</code> <code>R_KEY_TYPE_EC</code>, <code>R_KEY_TYPE_EDDSA</code> or <code>R_KEY_TYPE_ECDH</code>. The <code>bits</code> parameter specifies the length of the key. A RSA key must be at least 2048 bits, and the bits value allowed for an ECC key are 256, 384 or 512.</p>
<p>If the parameter <code>kid</code> is used, the generated key kid property will have the kid specified, otherwise a <code>kid</code> will be generated to identify the key pair.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwk__validate.html#ga506e98d70cc77ba0ed2b012bcaee14f3">r_jwk_generate_key_pair</a>(<a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_privkey, <a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_pubkey, <span class="keywordtype">int</span> type, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bits, <span class="keyword">const</span> <span class="keywordtype">char</span> * kid);</div>
<div class="ttc" id="agroup__jwk__validate_html_ga506e98d70cc77ba0ed2b012bcaee14f3"><div class="ttname"><a href="group__jwk__validate.html#ga506e98d70cc77ba0ed2b012bcaee14f3">r_jwk_generate_key_pair</a></div><div class="ttdeci">int r_jwk_generate_key_pair(jwk_t *jwk_privkey, jwk_t *jwk_pubkey, int type, unsigned int bits, const char *kid)</div><div class="ttdef"><b>Definition:</b> jwk.c:487</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md12"></a>
JWKS</h1>
<p>A JWKS (JSON Web Key Set) is a format used to store and represent a set cryptographic key in a JSON object. A JWKS is always a JSON object containing the property <code>"keys"</code> that will point to an array of JWK.</p>
<p>Example of JWKS:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;keys&quot;:</div>
<div class="line">  [</div>
<div class="line">    {</div>
<div class="line">      &quot;kty&quot;:&quot;EC&quot;,</div>
<div class="line">      &quot;crv&quot;:&quot;P-256&quot;,</div>
<div class="line">      &quot;x&quot;:&quot;MKBCTNIcKUSDii11ySs3526iDZ8AiTo7Tu6KPAqv7D4&quot;,</div>
<div class="line">      &quot;y&quot;:&quot;4Etl6SRW2YiLUrN5vfvVHuhp7x8PxltmWWlbbM4IFyM&quot;,</div>
<div class="line">      &quot;use&quot;:&quot;enc&quot;,</div>
<div class="line">      &quot;kid&quot;:&quot;1&quot;</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">      &quot;kty&quot;:&quot;RSA&quot;,</div>
<div class="line">      &quot;n&quot;: &quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKRXjBZCiFV4n3oknjhMstn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHzu6qMQvRL5hajrn1n91CbOpbISD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqbw0Ls1jF44-csFCur-kEgU8awapJzKnqDKgw&quot;,</div>
<div class="line">      &quot;e&quot;:&quot;AQAB&quot;,</div>
<div class="line">      &quot;alg&quot;:&quot;RS256&quot;,</div>
<div class="line">      &quot;kid&quot;:&quot;2011-04-29&quot;</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>In Rhonabwy library, you can manipulate the JWKS inside a JWKS by iteration or get a JWK by its kid.</p>
<div class="fragment"><div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * <a class="code" href="group__jwks.html#gaccfb6d0b8d071c92ceeb5c7bd48047e5">r_jwks_get_at</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> * jwks, <span class="keywordtype">size_t</span> index);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * <a class="code" href="group__jwks.html#ga7846e6ec4d66f2baec08a6900dd55f02">r_jwks_get_by_kid</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> * jwks, <span class="keyword">const</span> <span class="keywordtype">char</span> * kid);</div>
<div class="ttc" id="agroup__jwks_html_ga7846e6ec4d66f2baec08a6900dd55f02"><div class="ttname"><a href="group__jwks.html#ga7846e6ec4d66f2baec08a6900dd55f02">r_jwks_get_by_kid</a></div><div class="ttdeci">jwk_t * r_jwks_get_by_kid(jwks_t *jwks, const char *kid)</div><div class="ttdef"><b>Definition:</b> jwks.c:84</div></div>
<div class="ttc" id="agroup__jwks_html_gaccfb6d0b8d071c92ceeb5c7bd48047e5"><div class="ttname"><a href="group__jwks.html#gaccfb6d0b8d071c92ceeb5c7bd48047e5">r_jwks_get_at</a></div><div class="ttdeci">jwk_t * r_jwks_get_at(jwks_t *jwks, size_t index)</div><div class="ttdef"><b>Definition:</b> jwks.c:76</div></div>
</div><!-- fragment --><p>You can also import a JWKS using a JSON object or an URL.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwks.html#gac7fd6ecf065d01d22375c06494ef91cc">r_jwks_import_from_json_str</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> * jwks, <span class="keyword">const</span> <span class="keywordtype">char</span> * input);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwks.html#ga6c32c46305421cf0eed3c6f3ea91a798">r_jwks_import_from_json_t</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> * jwks, json_t * j_input);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwks.html#ga37b2cc95af08528b2d80f590f69a9280">r_jwks_import_from_uri</a>(<a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> * jwks, <span class="keyword">const</span> <span class="keywordtype">char</span> * uri, <span class="keywordtype">int</span> flags);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> * <a class="code" href="group__jwks.html#gae4ba88e4c54aedd5b930ad230dd934cd">r_jwks_quick_import</a>(<a class="code" href="group__type.html#ga7ac7039b8e1cc414d3da273c244ed591">rhn_import</a>, ...);</div>
<div class="ttc" id="agroup__jwks_html_ga37b2cc95af08528b2d80f590f69a9280"><div class="ttname"><a href="group__jwks.html#ga37b2cc95af08528b2d80f590f69a9280">r_jwks_import_from_uri</a></div><div class="ttdeci">int r_jwks_import_from_uri(jwks_t *jwks, const char *uri, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwks.c:310</div></div>
<div class="ttc" id="agroup__jwks_html_ga6c32c46305421cf0eed3c6f3ea91a798"><div class="ttname"><a href="group__jwks.html#ga6c32c46305421cf0eed3c6f3ea91a798">r_jwks_import_from_json_t</a></div><div class="ttdeci">int r_jwks_import_from_json_t(jwks_t *jwks, json_t *j_input)</div><div class="ttdef"><b>Definition:</b> jwks.c:271</div></div>
<div class="ttc" id="agroup__jwks_html_gac7fd6ecf065d01d22375c06494ef91cc"><div class="ttname"><a href="group__jwks.html#gac7fd6ecf065d01d22375c06494ef91cc">r_jwks_import_from_json_str</a></div><div class="ttdeci">int r_jwks_import_from_json_str(jwks_t *jwks, const char *input)</div><div class="ttdef"><b>Definition:</b> jwks.c:248</div></div>
<div class="ttc" id="agroup__jwks_html_gae4ba88e4c54aedd5b930ad230dd934cd"><div class="ttname"><a href="group__jwks.html#gae4ba88e4c54aedd5b930ad230dd934cd">r_jwks_quick_import</a></div><div class="ttdeci">jwks_t * r_jwks_quick_import(rhn_import type,...)</div><div class="ttdef"><b>Definition:</b> jwks.c:336</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md13"></a>
JWT</h1>
<p>Finally, a JWT (JSON Web Token) is a JSON content signed and/or encrypted and serialized in a compact format that can be easily transferred in HTTP requests. Technically, a JWT is a JWS or a JWE which payload is a stringified JSON and has the property <code>"type":"JWT"</code> in the header.</p>
<p>A JWT can be nested, which means signed and encrypted, in which case the payload is signed as a JWS first, then the serialized signed token is used as the payload in a JWE, or the opposite.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Set values</h2>
<p>To set the values of the JWT (header, keys, payload, etc.), you can use the dedicated functions (see the documentation), or use the function <code>r_jwt_set_properties</code> to set multiple properties at once. The option list MUST end with the option <code>RHN_OPT_NONE</code>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwt.html#ga93ff40881d89998eaa2cefe4385bb175">r_jwt_set_properties</a>(<a class="code" href="structjwt__t.html">jwt_t</a> * jwt, ...);</div>
<div class="ttc" id="agroup__jwt_html_ga93ff40881d89998eaa2cefe4385bb175"><div class="ttname"><a href="group__jwt.html#ga93ff40881d89998eaa2cefe4385bb175">r_jwt_set_properties</a></div><div class="ttdeci">int r_jwt_set_properties(jwt_t *jwt,...)</div><div class="ttdef"><b>Definition:</b> jwt.c:2054</div></div>
</div><!-- fragment --><p>The available <code>rhn_opt</code> and their following values for a <code><a class="el" href="structjwt__t.html">jwt_t</a></code> are:</p>
<div class="fragment"><div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0ea0448c1d0c968077dec9b5994d8570">RHN_OPT_HEADER_INT_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">int</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a8517fe52c309d9c4e6d3cff567041626">RHN_OPT_HEADER_RHN_INT_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <a class="code" href="group__type.html#ga6757151c907d670d38e412e623c0309b">rhn_int_t</a></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a502c5d3b3748cd27ff97895c8d6d8405">RHN_OPT_HEADER_STR_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0c0a789329c4c331fa210d5a6f9a2ac5">RHN_OPT_HEADER_JSON_T_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a6a2e0fbadbe28205282a6102d60d15f5">RHN_OPT_HEADER_FULL_JSON_T</a>, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a1a2c54296bfe7135b46ea89a5e5025a4">RHN_OPT_HEADER_FULL_JSON_STR</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a74068aeb2cbaf7a6afdfbc94aa47b1da">RHN_OPT_CLAIM_INT_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">int</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ac5212a08ebe87297761702ac396a3bc3">RHN_OPT_CLAIM_RHN_INT_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <a class="code" href="group__type.html#ga6757151c907d670d38e412e623c0309b">rhn_int_t</a></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a827f23fda36ef6a6381a8e35c2b1a058">RHN_OPT_CLAIM_STR_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a978cec3203c016291e9d1feee452ed48">RHN_OPT_CLAIM_JSON_T_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ac11f081db984ba118a2a56b7354a938a">RHN_OPT_CLAIM_FULL_JSON_T</a>, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a7ecbee0637864c99a71c413d98cdbf61">RHN_OPT_CLAIM_FULL_JSON_STR</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a088ca2f913481ff69b486b3977c61179">RHN_OPT_SIG_ALG</a>, <a class="code" href="group__type.html#gaaf028013558b5ff9aa99ff4afc3ae2ea">jwa_alg</a></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ac2374e1b6b62a3b07197c52a93f925a6">RHN_OPT_ENC_ALG</a>, <a class="code" href="group__type.html#gaaf028013558b5ff9aa99ff4afc3ae2ea">jwa_alg</a></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ad5e5eaa26dfc6cb43c2a5787e5382d31">RHN_OPT_ENC</a>, <a class="code" href="group__type.html#ga34a92d88d5befd0170a6b82ec53ef020">jwa_enc</a></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a75cbb9a6c8895781e8045323953f29ef">RHN_OPT_CIPHER_KEY</a>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a82a19cbd2d2579513b9ea8d7c0e4f858">RHN_OPT_IV</a>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a7d9f4877070fb37224b3cbb6900b3c14">RHN_OPT_SIGN_KEY_JWK</a>, <a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402aa5ca058c2c0c465ff0699fed1db46abd">RHN_OPT_SIGN_KEY_JWKS</a>, <a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a3804634b86406a1eef280df58bb3402f">RHN_OPT_SIGN_KEY_GNUTLS</a>, gnutls_privkey_t</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a15eaf3170167396aa6daff26b9f018c8">RHN_OPT_SIGN_KEY_JSON_T</a>, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ab445d6fa54b6f04bc100493834b0d983">RHN_OPT_SIGN_KEY_JSON_STR</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a84369d36b933aaecbbba3af453869f78">RHN_OPT_SIGN_KEY_PEM_DER</a>, uint, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a2789a2c85064106bcb0e43433746afe5">RHN_OPT_VERIFY_KEY_JWK</a>, <a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a073305504de0376b363830faa39e6a8c">RHN_OPT_VERIFY_KEY_JWKS</a>, <a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a2a1508af75c9b400453948c650baca91">RHN_OPT_VERIFY_KEY_GNUTLS</a>, gnutls_pubkey_t</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ac72af1210a1c3f48e9c4588698b186a4">RHN_OPT_VERIFY_KEY_JSON_T</a>, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a74e2befc9eaff371d4801b7b7b724cde">RHN_OPT_VERIFY_KEY_JSON_STR</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a7e816f846fa39d7c0ac9a1f669f82864">RHN_OPT_VERIFY_KEY_PEM_DER</a>, uint, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402aec7ea054ff0b0262ad4f755896a23bca">RHN_OPT_ENCRYPT_KEY_JWK</a>, <a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402aec369cd6472feadfeeb70f0c4b9f95de">RHN_OPT_ENCRYPT_KEY_JWKS</a>, <a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a28e6000e49f87a835dfe58825c9cbedc">RHN_OPT_ENCRYPT_KEY_GNUTLS</a>, gnutls_pubkey_t</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a16f4eea7c6035ad8311509d23950f8d2">RHN_OPT_ENCRYPT_KEY_JSON_T</a>, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a216199ac195850890a96299cfb4d147f">RHN_OPT_ENCRYPT_KEY_JSON_STR</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a5320c4edd278e1a945147c7a87d44310">RHN_OPT_ENCRYPT_KEY_PEM_DER</a>, uint, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a12049510fcaef29c2ef4d1b95245bf06">RHN_OPT_DECRYPT_KEY_JWK</a>, <a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a1a446f5001dfca1674a7d0f5193c8b01">RHN_OPT_DECRYPT_KEY_JWKS</a>, <a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402acd9f2decb365f6e9d52e035c8af21a5c">RHN_OPT_DECRYPT_KEY_GNUTLS</a>, gnutls_privkey_t</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a875eddf1c2db86da4e021f390affaa0c">RHN_OPT_DECRYPT_KEY_JSON_T</a>, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a28baf76e56201b3c71c431948e812733">RHN_OPT_DECRYPT_KEY_JSON_STR</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402aa2b6f594db59a1c3448a1c830d39da70">RHN_OPT_DECRYPT_KEY_PEM_DER</a>, uint, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="ttc" id="agroup__type_html_ga34a92d88d5befd0170a6b82ec53ef020"><div class="ttname"><a href="group__type.html#ga34a92d88d5befd0170a6b82ec53ef020">jwa_enc</a></div><div class="ttdeci">jwa_enc</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:169</div></div>
<div class="ttc" id="agroup__type_html_gaaf028013558b5ff9aa99ff4afc3ae2ea"><div class="ttname"><a href="group__type.html#gaaf028013558b5ff9aa99ff4afc3ae2ea">jwa_alg</a></div><div class="ttdeci">jwa_alg</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:117</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a073305504de0376b363830faa39e6a8c"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a073305504de0376b363830faa39e6a8c">RHN_OPT_VERIFY_KEY_JWKS</a></div><div class="ttdeci">@ RHN_OPT_VERIFY_KEY_JWKS</div><div class="ttdoc">Public key set in JWKS format to verify the token signature, following parameter must be a jwks_t * v...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:209</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a088ca2f913481ff69b486b3977c61179"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a088ca2f913481ff69b486b3977c61179">RHN_OPT_SIG_ALG</a></div><div class="ttdeci">@ RHN_OPT_SIG_ALG</div><div class="ttdoc">Signature algorithm, following parameter must be a jwa_alg value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:198</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a0c0a789329c4c331fa210d5a6f9a2ac5"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0c0a789329c4c331fa210d5a6f9a2ac5">RHN_OPT_HEADER_JSON_T_VALUE</a></div><div class="ttdeci">@ RHN_OPT_HEADER_JSON_T_VALUE</div><div class="ttdoc">Header JSON value, following parameters must be const char * name, json_t * j_value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:184</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a0ea0448c1d0c968077dec9b5994d8570"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0ea0448c1d0c968077dec9b5994d8570">RHN_OPT_HEADER_INT_VALUE</a></div><div class="ttdeci">@ RHN_OPT_HEADER_INT_VALUE</div><div class="ttdoc">Header Integer value, following parameters must be const char * name, int i_value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:181</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a12049510fcaef29c2ef4d1b95245bf06"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a12049510fcaef29c2ef4d1b95245bf06">RHN_OPT_DECRYPT_KEY_JWK</a></div><div class="ttdeci">@ RHN_OPT_DECRYPT_KEY_JWK</div><div class="ttdoc">Private key in JWK format to decrypt the token, following parameter must be a jwk_t * value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:220</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a15eaf3170167396aa6daff26b9f018c8"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a15eaf3170167396aa6daff26b9f018c8">RHN_OPT_SIGN_KEY_JSON_T</a></div><div class="ttdeci">@ RHN_OPT_SIGN_KEY_JSON_T</div><div class="ttdoc">Private key in JSON format to sign the token, following parameter must be a json_t * value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:205</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a16f4eea7c6035ad8311509d23950f8d2"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a16f4eea7c6035ad8311509d23950f8d2">RHN_OPT_ENCRYPT_KEY_JSON_T</a></div><div class="ttdeci">@ RHN_OPT_ENCRYPT_KEY_JSON_T</div><div class="ttdoc">Public key in JSON format to encrypt the token, following parameter must be a json_t * value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:217</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a1a2c54296bfe7135b46ea89a5e5025a4"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a1a2c54296bfe7135b46ea89a5e5025a4">RHN_OPT_HEADER_FULL_JSON_STR</a></div><div class="ttdeci">@ RHN_OPT_HEADER_FULL_JSON_STR</div><div class="ttdoc">Stringified JSON value to set the entire header, following parameter must be const char * str_value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:186</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a1a446f5001dfca1674a7d0f5193c8b01"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a1a446f5001dfca1674a7d0f5193c8b01">RHN_OPT_DECRYPT_KEY_JWKS</a></div><div class="ttdeci">@ RHN_OPT_DECRYPT_KEY_JWKS</div><div class="ttdoc">Private key set in JWKS format to decrypt the token, following parameter must be a jwks_t * value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:221</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a216199ac195850890a96299cfb4d147f"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a216199ac195850890a96299cfb4d147f">RHN_OPT_ENCRYPT_KEY_JSON_STR</a></div><div class="ttdeci">@ RHN_OPT_ENCRYPT_KEY_JSON_STR</div><div class="ttdoc">Public key in stringified JSON format to encrypt the token, following parameter must be a const char ...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:218</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a2789a2c85064106bcb0e43433746afe5"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a2789a2c85064106bcb0e43433746afe5">RHN_OPT_VERIFY_KEY_JWK</a></div><div class="ttdeci">@ RHN_OPT_VERIFY_KEY_JWK</div><div class="ttdoc">Public key in JWK format to verify the token signature, following parameter must be a jwk_t * value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:208</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a28baf76e56201b3c71c431948e812733"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a28baf76e56201b3c71c431948e812733">RHN_OPT_DECRYPT_KEY_JSON_STR</a></div><div class="ttdeci">@ RHN_OPT_DECRYPT_KEY_JSON_STR</div><div class="ttdoc">Private key in stringified JSON format to decrypt the token, following parameter must be a const char...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:224</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a28e6000e49f87a835dfe58825c9cbedc"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a28e6000e49f87a835dfe58825c9cbedc">RHN_OPT_ENCRYPT_KEY_GNUTLS</a></div><div class="ttdeci">@ RHN_OPT_ENCRYPT_KEY_GNUTLS</div><div class="ttdoc">Public key in GnuTLS format to encrypt the token, following parameter must be a gnutls_pubkey_t value...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:216</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a2a1508af75c9b400453948c650baca91"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a2a1508af75c9b400453948c650baca91">RHN_OPT_VERIFY_KEY_GNUTLS</a></div><div class="ttdeci">@ RHN_OPT_VERIFY_KEY_GNUTLS</div><div class="ttdoc">Public key in GnuTLS format to verify the token signature, following parameter must be a gnutls_pubke...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:210</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a3804634b86406a1eef280df58bb3402f"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a3804634b86406a1eef280df58bb3402f">RHN_OPT_SIGN_KEY_GNUTLS</a></div><div class="ttdeci">@ RHN_OPT_SIGN_KEY_GNUTLS</div><div class="ttdoc">Private key in GnuTLS format to sign the token, following parameter must be a gnutls_privkey_t value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:204</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a502c5d3b3748cd27ff97895c8d6d8405"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a502c5d3b3748cd27ff97895c8d6d8405">RHN_OPT_HEADER_STR_VALUE</a></div><div class="ttdeci">@ RHN_OPT_HEADER_STR_VALUE</div><div class="ttdoc">Header String value, following parameters must be const char * name, const char * str_value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:183</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a5320c4edd278e1a945147c7a87d44310"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a5320c4edd278e1a945147c7a87d44310">RHN_OPT_ENCRYPT_KEY_PEM_DER</a></div><div class="ttdeci">@ RHN_OPT_ENCRYPT_KEY_PEM_DER</div><div class="ttdoc">Public key in PEM or DER format to encrypt the token, following parameter must be R_FORMAT_PEM or R_F...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:219</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a6a2e0fbadbe28205282a6102d60d15f5"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a6a2e0fbadbe28205282a6102d60d15f5">RHN_OPT_HEADER_FULL_JSON_T</a></div><div class="ttdeci">@ RHN_OPT_HEADER_FULL_JSON_T</div><div class="ttdoc">JSON value to set the entire header, following parameter must be json_t * j_value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:185</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a74068aeb2cbaf7a6afdfbc94aa47b1da"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a74068aeb2cbaf7a6afdfbc94aa47b1da">RHN_OPT_CLAIM_INT_VALUE</a></div><div class="ttdeci">@ RHN_OPT_CLAIM_INT_VALUE</div><div class="ttdoc">Claims Integer value, following parameters must be const char * name, int i_value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:190</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a74e2befc9eaff371d4801b7b7b724cde"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a74e2befc9eaff371d4801b7b7b724cde">RHN_OPT_VERIFY_KEY_JSON_STR</a></div><div class="ttdeci">@ RHN_OPT_VERIFY_KEY_JSON_STR</div><div class="ttdoc">Public key in stringified JSON format to verify the token signature, following parameter must be a co...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:212</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a75cbb9a6c8895781e8045323953f29ef"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a75cbb9a6c8895781e8045323953f29ef">RHN_OPT_CIPHER_KEY</a></div><div class="ttdeci">@ RHN_OPT_CIPHER_KEY</div><div class="ttdoc">Cipher key to encrypt data, following parameters must be const unsigned char * value,...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:199</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a7d9f4877070fb37224b3cbb6900b3c14"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a7d9f4877070fb37224b3cbb6900b3c14">RHN_OPT_SIGN_KEY_JWK</a></div><div class="ttdeci">@ RHN_OPT_SIGN_KEY_JWK</div><div class="ttdoc">Private key in JWK format to sign the token, following parameter must be a jwk_t * value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:202</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a7e816f846fa39d7c0ac9a1f669f82864"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a7e816f846fa39d7c0ac9a1f669f82864">RHN_OPT_VERIFY_KEY_PEM_DER</a></div><div class="ttdeci">@ RHN_OPT_VERIFY_KEY_PEM_DER</div><div class="ttdoc">Public key in PEM or DER format to verify the token signature, following parameter must be R_FORMAT_P...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:213</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a7ecbee0637864c99a71c413d98cdbf61"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a7ecbee0637864c99a71c413d98cdbf61">RHN_OPT_CLAIM_FULL_JSON_STR</a></div><div class="ttdeci">@ RHN_OPT_CLAIM_FULL_JSON_STR</div><div class="ttdoc">Stringified JSON value to set the entire claims, following parameter must be const char * str_value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:195</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a827f23fda36ef6a6381a8e35c2b1a058"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a827f23fda36ef6a6381a8e35c2b1a058">RHN_OPT_CLAIM_STR_VALUE</a></div><div class="ttdeci">@ RHN_OPT_CLAIM_STR_VALUE</div><div class="ttdoc">Claims String value, following parameters must be const char * name, const char * str_value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:192</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a82a19cbd2d2579513b9ea8d7c0e4f858"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a82a19cbd2d2579513b9ea8d7c0e4f858">RHN_OPT_IV</a></div><div class="ttdeci">@ RHN_OPT_IV</div><div class="ttdoc">Initial Value (IV) for data encryption, following parameters must be const unsigned char * value,...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:200</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a84369d36b933aaecbbba3af453869f78"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a84369d36b933aaecbbba3af453869f78">RHN_OPT_SIGN_KEY_PEM_DER</a></div><div class="ttdeci">@ RHN_OPT_SIGN_KEY_PEM_DER</div><div class="ttdoc">Private key in PEM or DER format to sign the token, following parameter must be R_FORMAT_PEM or R_FOR...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:207</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a8517fe52c309d9c4e6d3cff567041626"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a8517fe52c309d9c4e6d3cff567041626">RHN_OPT_HEADER_RHN_INT_VALUE</a></div><div class="ttdeci">@ RHN_OPT_HEADER_RHN_INT_VALUE</div><div class="ttdoc">Header rhn_int_t value, following parameters must be const char * name, rhn_int_t i_value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:182</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a875eddf1c2db86da4e021f390affaa0c"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a875eddf1c2db86da4e021f390affaa0c">RHN_OPT_DECRYPT_KEY_JSON_T</a></div><div class="ttdeci">@ RHN_OPT_DECRYPT_KEY_JSON_T</div><div class="ttdoc">Private key in JSON format to decrypt the token, following parameter must be a json_t * value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:223</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a978cec3203c016291e9d1feee452ed48"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a978cec3203c016291e9d1feee452ed48">RHN_OPT_CLAIM_JSON_T_VALUE</a></div><div class="ttdeci">@ RHN_OPT_CLAIM_JSON_T_VALUE</div><div class="ttdoc">Claims JSON value, following parameters must be const char * name, json_t * j_value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:193</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402aa2b6f594db59a1c3448a1c830d39da70"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402aa2b6f594db59a1c3448a1c830d39da70">RHN_OPT_DECRYPT_KEY_PEM_DER</a></div><div class="ttdeci">@ RHN_OPT_DECRYPT_KEY_PEM_DER</div><div class="ttdoc">Private key in PEM or DER format to decrypt the token, following parameter must be R_FORMAT_PEM or R_...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:225</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402aa5ca058c2c0c465ff0699fed1db46abd"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402aa5ca058c2c0c465ff0699fed1db46abd">RHN_OPT_SIGN_KEY_JWKS</a></div><div class="ttdeci">@ RHN_OPT_SIGN_KEY_JWKS</div><div class="ttdoc">Private key set in JWKS format to sign the token, following parameter must be a jwks_t * value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:203</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402ab445d6fa54b6f04bc100493834b0d983"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402ab445d6fa54b6f04bc100493834b0d983">RHN_OPT_SIGN_KEY_JSON_STR</a></div><div class="ttdeci">@ RHN_OPT_SIGN_KEY_JSON_STR</div><div class="ttdoc">Private key in stringified JSON format to sign the token, following parameter must be a const char * ...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:206</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402ac11f081db984ba118a2a56b7354a938a"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402ac11f081db984ba118a2a56b7354a938a">RHN_OPT_CLAIM_FULL_JSON_T</a></div><div class="ttdeci">@ RHN_OPT_CLAIM_FULL_JSON_T</div><div class="ttdoc">JSON value to set the entire claims, following parameter must be json_t * j_value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:194</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402ac2374e1b6b62a3b07197c52a93f925a6"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402ac2374e1b6b62a3b07197c52a93f925a6">RHN_OPT_ENC_ALG</a></div><div class="ttdeci">@ RHN_OPT_ENC_ALG</div><div class="ttdoc">Key management algorithm, following parameter must be a jwa_alg value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:196</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402ac5212a08ebe87297761702ac396a3bc3"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402ac5212a08ebe87297761702ac396a3bc3">RHN_OPT_CLAIM_RHN_INT_VALUE</a></div><div class="ttdeci">@ RHN_OPT_CLAIM_RHN_INT_VALUE</div><div class="ttdoc">Claims Integer value, following parameters must be const char * name, int i_value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:191</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402ac72af1210a1c3f48e9c4588698b186a4"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402ac72af1210a1c3f48e9c4588698b186a4">RHN_OPT_VERIFY_KEY_JSON_T</a></div><div class="ttdeci">@ RHN_OPT_VERIFY_KEY_JSON_T</div><div class="ttdoc">Public key in JSON format to verify the token signature, following parameter must be a json_t * value...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:211</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402acd9f2decb365f6e9d52e035c8af21a5c"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402acd9f2decb365f6e9d52e035c8af21a5c">RHN_OPT_DECRYPT_KEY_GNUTLS</a></div><div class="ttdeci">@ RHN_OPT_DECRYPT_KEY_GNUTLS</div><div class="ttdoc">Private key in GnuTLS format to decrypt the token, following parameter must be a gnutls_privkey_t val...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:222</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402ad5e5eaa26dfc6cb43c2a5787e5382d31"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402ad5e5eaa26dfc6cb43c2a5787e5382d31">RHN_OPT_ENC</a></div><div class="ttdeci">@ RHN_OPT_ENC</div><div class="ttdoc">Encryption algorithm, following parameter must be a jwa_enc value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:197</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402aec369cd6472feadfeeb70f0c4b9f95de"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402aec369cd6472feadfeeb70f0c4b9f95de">RHN_OPT_ENCRYPT_KEY_JWKS</a></div><div class="ttdeci">@ RHN_OPT_ENCRYPT_KEY_JWKS</div><div class="ttdoc">Public key set in JWKS format to encrypt the token, following parameter must be a jwks_t * value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:215</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402aec7ea054ff0b0262ad4f755896a23bca"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402aec7ea054ff0b0262ad4f755896a23bca">RHN_OPT_ENCRYPT_KEY_JWK</a></div><div class="ttdeci">@ RHN_OPT_ENCRYPT_KEY_JWK</div><div class="ttdoc">Public key in JWK format to encrypt the token, following parameter must be a jwk_t * value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:214</div></div>
</div><!-- fragment --><p>Example of usage for <code>r_jwt_set_properties</code>:</p>
<div class="fragment"><div class="line"><a class="code" href="structjwt__t.html">jwt_t</a> * jwt;</div>
<div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk; <span class="comment">// Set a private RSA key in this value</span></div>
<div class="line"><a class="code" href="group__jwt.html#ga93ff40881d89998eaa2cefe4385bb175">r_jwt_set_properties</a>(jwt, <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0ea0448c1d0c968077dec9b5994d8570">RHN_OPT_HEADER_INT_VALUE</a>, <span class="stringliteral">&quot;int&quot;</span>, 42,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a502c5d3b3748cd27ff97895c8d6d8405">RHN_OPT_HEADER_STR_VALUE</a>, <span class="stringliteral">&quot;str&quot;</span>, <span class="stringliteral">&quot;a value&quot;</span>,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0c0a789329c4c331fa210d5a6f9a2ac5">RHN_OPT_HEADER_JSON_T_VALUE</a>, <span class="stringliteral">&quot;json&quot;</span>, json_true(),</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a7ecbee0637864c99a71c413d98cdbf61">RHN_OPT_CLAIM_FULL_JSON_STR</a>, <span class="stringliteral">&quot;{\&quot;str\&quot;:\&quot;grut\&quot;,\&quot;int\&quot;:42,\&quot;obj\&quot;:true}&quot;</span>,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a088ca2f913481ff69b486b3977c61179">RHN_OPT_SIG_ALG</a>, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaaaf2f117cfb4fea32399b19f684d87451">R_JWA_ALG_RS256</a>,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a7d9f4877070fb37224b3cbb6900b3c14">RHN_OPT_SIGN_KEY_JWK</a>, jwk,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402add9d6beaac445b88123fa1554cb05f66">RHN_OPT_NONE</a>); <span class="comment">// Test if return value is RHN_OK</span></div>
<div class="line"><span class="keywordtype">char</span> * token = <a class="code" href="group__jwt.html#ga0258ed4e9756ca3ecc318a54ca85b05f">r_jwt_serialize_signed</a>(jwt, NULL, 0);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__jwt_html_ga0258ed4e9756ca3ecc318a54ca85b05f"><div class="ttname"><a href="group__jwt.html#ga0258ed4e9756ca3ecc318a54ca85b05f">r_jwt_serialize_signed</a></div><div class="ttdeci">char * r_jwt_serialize_signed(jwt_t *jwt, jwk_t *privkey, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwt.c:1006</div></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402add9d6beaac445b88123fa1554cb05f66"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402add9d6beaac445b88123fa1554cb05f66">RHN_OPT_NONE</a></div><div class="ttdeci">@ RHN_OPT_NONE</div><div class="ttdoc">End option list, mandatory at the end of the option list.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:180</div></div>
<div class="ttc" id="agroup__type_html_ggaaf028013558b5ff9aa99ff4afc3ae2eaaaf2f117cfb4fea32399b19f684d87451"><div class="ttname"><a href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaaaf2f117cfb4fea32399b19f684d87451">R_JWA_ALG_RS256</a></div><div class="ttdeci">@ R_JWA_ALG_RS256</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:123</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md15"></a>
Verify a list of claims in the JWT</h2>
<p>The function int <code>int <a class="el" href="group__jwt.html#gaa0445e80af0bc65f787ed2205780feb8">r_jwt_validate_claims(jwt_t * jwt, ...)</a></code> will help you verify the validity of some claims in the JWT.</p>
<p>Claim types available</p><ul>
<li><code>R_JWT_CLAIM_ISS</code>: claim <code>"iss"</code>, values expected a string or <code>NULL</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_SUB</code>: claim <code>"sub"</code>, values expected a string or <code>NULL</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_AUD</code>: claim <code>"aud"</code>, values expected a string or <code>NULL</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_EXP</code>: claim <code>"exp"</code>, value expected <code>R_JWT_CLAIM_NOW</code> or an positive integer value or <code>R_JWT_CLAIM_PRESENT</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_NBF</code>: claim <code>"nbf"</code>, value expected <code>R_JWT_CLAIM_NOW</code> or an positive integer value or <code>R_JWT_CLAIM_PRESENT</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_IAT</code>: claim <code>"iat"</code>, value expected <code>R_JWT_CLAIM_NOW</code> or an positive integer value or <code>R_JWT_CLAIM_PRESENT</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_JTI</code>: claim <code>"jti"</code>, values expected a string or <code>NULL</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_STR</code>: the claim name specified must have the string value expected or <code>NULL</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_INT</code>: the claim name specified must have the integer value expected</li>
<li><code>R_JWT_CLAIM_JSN</code>: the claim name specified must have the json_t * value expected or <code>NULL</code> to validate the presence of the claim</li>
<li><code>R_JWT_CLAIM_TYP</code>: header parameter <code>"typ"</code> (type), values expected a string or <code>NULL</code> to validate the presence of the header parameter</li>
<li><code>R_JWT_CLAIM_CTY</code>: header parameter <code>"cty"</code> (Content Type), values expected a string or <code>NULL</code> to validate the presence of the header parameter</li>
</ul>
<p>For example, the following code will check the jwt against the claim <code>iss</code> has the value <code>"https://example.com"</code>, the claim <code>sub</code> has the value <code>"client_1"</code>, the presence of the claim <code>aud</code>, the claim <code>exp</code> is after now, the claim <code>nbf</code> is before now, the claim <code>scope</code> has the value <code>"scope1"</code>, the claim <code>age</code> has the value <code>42</code> and the claim <code>verified</code> has the JSON value <code>true</code>:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__jwt.html#gaa0445e80af0bc65f787ed2205780feb8">r_jwt_validate_claims</a>(jwt, <a class="code" href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaa049a1ea3ac2b6f3cd4f3280a98a3142f">R_JWT_CLAIM_ISS</a>, <span class="stringliteral">&quot;https://example.com&quot;</span>, </div>
<div class="line">                               <a class="code" href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaa2704bc03d3c4328d2c3f711ba29bf965">R_JWT_CLAIM_SUB</a>, <span class="stringliteral">&quot;client_1&quot;</span>, </div>
<div class="line">                               <a class="code" href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaacc9e7d4ec5bb3ad6076a9dcdcc6d2bf5">R_JWT_CLAIM_AUD</a>, NULL, </div>
<div class="line">                               <a class="code" href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaab99b5158519f43258e27d933edd0a58d">R_JWT_CLAIM_EXP</a>, <a class="code" href="group__const.html#gaf01bb3c8cd1b6f545fa0ff7c9ffda9e5">R_JWT_CLAIM_NOW</a>, </div>
<div class="line">                               <a class="code" href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaa38d2704e161b3330a0d1654aa50a2dca">R_JWT_CLAIM_NBF</a>, <a class="code" href="group__const.html#gaf01bb3c8cd1b6f545fa0ff7c9ffda9e5">R_JWT_CLAIM_NOW</a>, </div>
<div class="line">                               <a class="code" href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaa74d807cabfa1323cde1a4e1ebac4f9a6">R_JWT_CLAIM_STR</a>, <span class="stringliteral">&quot;scope&quot;</span>, <span class="stringliteral">&quot;scope1&quot;</span>,</div>
<div class="line">                               <a class="code" href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaab075fbac3e45e7226062c271aa329c13">R_JWT_CLAIM_INT</a>, <span class="stringliteral">&quot;age&quot;</span>, 42,</div>
<div class="line">                               <a class="code" href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaa48a188a37beff213c705118d968bb990">R_JWT_CLAIM_JSN</a>, <span class="stringliteral">&quot;verified&quot;</span>, json_true(),</div>
<div class="line">                               <a class="code" href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaabae0a94857afd45040ef42159396c9fa">R_JWT_CLAIM_NOP</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a>)</div>
<div class="ttc" id="agroup__const_html_ga3fc690cb1d601c13fce959aff60de0d7"><div class="ttname"><a href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a></div><div class="ttdeci">#define RHN_OK</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:46</div></div>
<div class="ttc" id="agroup__const_html_gaf01bb3c8cd1b6f545fa0ff7c9ffda9e5"><div class="ttname"><a href="group__const.html#gaf01bb3c8cd1b6f545fa0ff7c9ffda9e5">R_JWT_CLAIM_NOW</a></div><div class="ttdeci">#define R_JWT_CLAIM_NOW</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:81</div></div>
<div class="ttc" id="agroup__jwt_html_gaa0445e80af0bc65f787ed2205780feb8"><div class="ttname"><a href="group__jwt.html#gaa0445e80af0bc65f787ed2205780feb8">r_jwt_validate_claims</a></div><div class="ttdeci">int r_jwt_validate_claims(jwt_t *jwt,...)</div><div class="ttdef"><b>Definition:</b> jwt.c:1693</div></div>
<div class="ttc" id="agroup__type_html_gga98ec878b1cfbb1ca4c5b845006aabfdaa049a1ea3ac2b6f3cd4f3280a98a3142f"><div class="ttname"><a href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaa049a1ea3ac2b6f3cd4f3280a98a3142f">R_JWT_CLAIM_ISS</a></div><div class="ttdeci">@ R_JWT_CLAIM_ISS</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:155</div></div>
<div class="ttc" id="agroup__type_html_gga98ec878b1cfbb1ca4c5b845006aabfdaa2704bc03d3c4328d2c3f711ba29bf965"><div class="ttname"><a href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaa2704bc03d3c4328d2c3f711ba29bf965">R_JWT_CLAIM_SUB</a></div><div class="ttdeci">@ R_JWT_CLAIM_SUB</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:156</div></div>
<div class="ttc" id="agroup__type_html_gga98ec878b1cfbb1ca4c5b845006aabfdaa38d2704e161b3330a0d1654aa50a2dca"><div class="ttname"><a href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaa38d2704e161b3330a0d1654aa50a2dca">R_JWT_CLAIM_NBF</a></div><div class="ttdeci">@ R_JWT_CLAIM_NBF</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:159</div></div>
<div class="ttc" id="agroup__type_html_gga98ec878b1cfbb1ca4c5b845006aabfdaa48a188a37beff213c705118d968bb990"><div class="ttname"><a href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaa48a188a37beff213c705118d968bb990">R_JWT_CLAIM_JSN</a></div><div class="ttdeci">@ R_JWT_CLAIM_JSN</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:164</div></div>
<div class="ttc" id="agroup__type_html_gga98ec878b1cfbb1ca4c5b845006aabfdaa74d807cabfa1323cde1a4e1ebac4f9a6"><div class="ttname"><a href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaa74d807cabfa1323cde1a4e1ebac4f9a6">R_JWT_CLAIM_STR</a></div><div class="ttdeci">@ R_JWT_CLAIM_STR</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:162</div></div>
<div class="ttc" id="agroup__type_html_gga98ec878b1cfbb1ca4c5b845006aabfdaab075fbac3e45e7226062c271aa329c13"><div class="ttname"><a href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaab075fbac3e45e7226062c271aa329c13">R_JWT_CLAIM_INT</a></div><div class="ttdeci">@ R_JWT_CLAIM_INT</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:163</div></div>
<div class="ttc" id="agroup__type_html_gga98ec878b1cfbb1ca4c5b845006aabfdaab99b5158519f43258e27d933edd0a58d"><div class="ttname"><a href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaab99b5158519f43258e27d933edd0a58d">R_JWT_CLAIM_EXP</a></div><div class="ttdeci">@ R_JWT_CLAIM_EXP</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:158</div></div>
<div class="ttc" id="agroup__type_html_gga98ec878b1cfbb1ca4c5b845006aabfdaabae0a94857afd45040ef42159396c9fa"><div class="ttname"><a href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaabae0a94857afd45040ef42159396c9fa">R_JWT_CLAIM_NOP</a></div><div class="ttdeci">@ R_JWT_CLAIM_NOP</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:154</div></div>
<div class="ttc" id="agroup__type_html_gga98ec878b1cfbb1ca4c5b845006aabfdaacc9e7d4ec5bb3ad6076a9dcdcc6d2bf5"><div class="ttname"><a href="group__type.html#gga98ec878b1cfbb1ca4c5b845006aabfdaacc9e7d4ec5bb3ad6076a9dcdcc6d2bf5">R_JWT_CLAIM_AUD</a></div><div class="ttdeci">@ R_JWT_CLAIM_AUD</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:157</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
Serialize a JWT using Rhonabwy</h2>
<p>Let's use the following JSON object in a JWT:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;iss&quot;:&quot;joe&quot;,</div>
<div class="line">  &quot;exp&quot;:1300819380,</div>
<div class="line">  &quot;http://example.com/is_root&quot;:true</div>
<div class="line">}</div>
</div><!-- fragment --><p>The JWT can be signed using the algorithm <code>HS256</code> and the following key:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;kty&quot;:&quot;oct&quot;,</div>
<div class="line">  &quot;k&quot;:&quot;AyM1SysPpbyDfgZld3umj1qzKObwVMkoqQ-EstJQLr_T-1qS0gZH75aKtMN3Yj0iPS4hcgUuTwjAzZr1Z9CAow&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The signed JWT serialized will be:</p>
<div class="fragment"><div class="line">eyJ0eXAiOiJKV1QiLA0KICJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJqb2UiLA0KICJleHAiOjEzMDA4MTkzODAsDQogImh0dHA6Ly9leGFtcGxlLmNvbS9pc19yb290Ijp0cnVlfQ.dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md17"></a>
Signed JWT</h3>
<p>The signed JWT above can be created with the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="structjwt__t.html">jwt_t</a> * jwt = NULL;</div>
<div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key = NULL;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> payload[] = <span class="stringliteral">&quot;{\&quot;iss\&quot;:\&quot;joe\&quot;,\&quot;exp\&quot;:1300819380,\&quot;http://example.com/is_root\&quot;:true}&quot;</span>,</div>
<div class="line">           jwk_key_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;oct\&quot;,\&quot;k\&quot;:\&quot;AyM1SysPpbyDfgZld3umj1qzKObwVMkoqQ-EstJQLr_T-1qS0gZH75aKtMN3Yj0iPS4hcgUuTwjAzZr1Z9CAow\&quot;}&quot;</span>;</div>
<div class="line"><span class="keywordtype">char</span> * token = NULL;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__core.html#gad5d9ca3960b9bf0c07dc1c1cbc8680c2">r_jwt_init</a>(&amp;jwt) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key, jwk_key_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__jwt.html#ga05240b4b4653381a11a2878d53aed62a">r_jwt_set_sign_alg</a>(jwt, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaad966cad0ad530e52f7ee6190823e54a3">R_JWA_ALG_HS256</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__jwt.html#ga6e302667bc0fb64903fa98bb745171d3">r_jwt_set_full_claims_json_str</a>(jwt, payload) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a>) {</div>
<div class="line">  token = <a class="code" href="group__jwt.html#ga0258ed4e9756ca3ecc318a54ca85b05f">r_jwt_serialize_signed</a>(jwt, jwk_key, 0); <span class="comment">// token will store the signed token</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a>(token);</div>
<div class="line"><a class="code" href="group__core.html#ga676cff4810db612ac0047c57ff5eff87">r_jwt_free</a>(jwt);</div>
<div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key);</div>
<div class="ttc" id="agroup__jwt_html_ga05240b4b4653381a11a2878d53aed62a"><div class="ttname"><a href="group__jwt.html#ga05240b4b4653381a11a2878d53aed62a">r_jwt_set_sign_alg</a></div><div class="ttdeci">int r_jwt_set_sign_alg(jwt_t *jwt, jwa_alg alg)</div><div class="ttdef"><b>Definition:</b> jwt.c:814</div></div>
<div class="ttc" id="agroup__jwt_html_ga6e302667bc0fb64903fa98bb745171d3"><div class="ttname"><a href="group__jwt.html#ga6e302667bc0fb64903fa98bb745171d3">r_jwt_set_full_claims_json_str</a></div><div class="ttdeci">int r_jwt_set_full_claims_json_str(jwt_t *jwt, const char *str_claims)</div><div class="ttdef"><b>Definition:</b> jwt.c:267</div></div>
<div class="ttc" id="agroup__type_html_ggaaf028013558b5ff9aa99ff4afc3ae2eaad966cad0ad530e52f7ee6190823e54a3"><div class="ttname"><a href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaad966cad0ad530e52f7ee6190823e54a3">R_JWA_ALG_HS256</a></div><div class="ttdeci">@ R_JWA_ALG_HS256</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:120</div></div>
<div class="ttc" id="arhonabwy_8h_html"><div class="ttname"><a href="rhonabwy_8h.html">rhonabwy.h</a></div><div class="ttdoc">Rhonabwy JSON Web Key (JWK) library.</div></div>
</div><!-- fragment --><p>The same payload can be encrypted and serialized in an encrypted JWT using <code>RSA1_5</code> as key encryption algorithm and <code>A128CBC-HS256</code> as content encryption algorithm.</p>
<p>The encrypted JWT of the payload above can be the following:</p>
<div class="fragment"><div class="line">eyJhbGciOiJSU0ExXzUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.QR1Owv2ug2WyPBnbQrRARTeEk9kDO2w8qDcjiHnSJflSdv1iNqhWXaKH4MqAkQtMoNfABIPJaZm0HaA415sv3aeuBWnD8J-Ui7Ah6cWafs3ZwwFKDFUUsWHSK-IPKxLGTkND09XyjORj_CHAgOPJ-Sd8ONQRnJvWn_hXV1BNMHzUjPyYwEsRhDhzjAD26imasOTsgruobpYGoQcXUwFDn7moXPRfDE8-NoQX7N7ZYMmpUDkR-Cx9obNGwJQ3nM52YCitxoQVPzjbl7WBuB7AohdBoZOdZ24WlN1lVIeh8v1K4krB8xgKvRU8kgFrEn_a1rZgN5TiysnmzTROF869lQ.AxY8DCtDaGlsbGljb3RoZQ.MKOle7UQrG6nSxTLX6Mqwt0orbHvAKeWnDYvpIAeZ72deHxz3roJDXQyhxx0wKaMHDjUEOKIwrtkHthpqEanSBNYHZgmNOV7sln1Eu9g3J8.fiK51VwhsxJ-siBMR-YFiA</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md18"></a>
Encrypted JWT</h3>
<p>An encrypted JWT can be created with Rhonabwy using the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="structjwt__t.html">jwt_t</a> * jwt = NULL;</div>
<div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key = NULL;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> payload[] = <span class="stringliteral">&quot;{\&quot;iss\&quot;:\&quot;joe\&quot;,\&quot;exp\&quot;:1300819380,\&quot;http://example.com/is_root\&quot;:true}&quot;</span>,</div>
<div class="line">jwk_pubkey_rsa_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;RSA\&quot;,\&quot;n\&quot;:\&quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKRX&quot;</span>\</div>
<div class="line">                      <span class="stringliteral">&quot;jBZCiFV4n3oknjhMstn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHzu6&quot;</span>\</div>
<div class="line">                      <span class="stringliteral">&quot;qMQvRL5hajrn1n91CbOpbISD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqbw0Ls1jF44-csFCur-kEgU8awapJzKnqDKgw\&quot;&quot;</span>\</div>
<div class="line">                      <span class="stringliteral">&quot;,\&quot;e\&quot;:\&quot;AQAB\&quot;,\&quot;alg\&quot;:\&quot;RS256\&quot;,\&quot;kid\&quot;:\&quot;2011-04-29\&quot;}&quot;</span>;</div>
<div class="line"><span class="keywordtype">char</span> * token = NULL;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__core.html#gad5d9ca3960b9bf0c07dc1c1cbc8680c2">r_jwt_init</a>(&amp;jwt) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key, jwk_pubkey_rsa_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__jwt.html#ga66a51e0d776df279994d68459020f13c">r_jwt_set_enc_alg</a>(jwt, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaa8310fea59b4b728f13a561d133f09ba6">R_JWA_ALG_RSA1_5</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__jwt.html#gac4ceb3eb242f1382a596622ce3dd8362">r_jwt_set_enc</a>(jwt, <a class="code" href="group__type.html#gga34a92d88d5befd0170a6b82ec53ef020a44cc75e8da8012a15089663a1ca8d7d9">R_JWA_ENC_A128CBC</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__jwt.html#ga6e302667bc0fb64903fa98bb745171d3">r_jwt_set_full_claims_json_str</a>(jwt, payload) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a>) {</div>
<div class="line">  token = <a class="code" href="group__jwt.html#gadbe8205e986358d27a84259af201e458">r_jwt_serialize_encrypted</a>(jwt, jwk_key, 0); <span class="comment">// token will store the encrypted token</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a>(token);</div>
<div class="line"><a class="code" href="group__core.html#ga676cff4810db612ac0047c57ff5eff87">r_jwt_free</a>(jwt);</div>
<div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key);</div>
<div class="ttc" id="agroup__jwt_html_ga66a51e0d776df279994d68459020f13c"><div class="ttname"><a href="group__jwt.html#ga66a51e0d776df279994d68459020f13c">r_jwt_set_enc_alg</a></div><div class="ttdeci">int r_jwt_set_enc_alg(jwt_t *jwt, jwa_alg alg)</div><div class="ttdef"><b>Definition:</b> jwt.c:834</div></div>
<div class="ttc" id="agroup__jwt_html_gac4ceb3eb242f1382a596622ce3dd8362"><div class="ttname"><a href="group__jwt.html#gac4ceb3eb242f1382a596622ce3dd8362">r_jwt_set_enc</a></div><div class="ttdeci">int r_jwt_set_enc(jwt_t *jwt, jwa_enc enc)</div><div class="ttdef"><b>Definition:</b> jwt.c:854</div></div>
<div class="ttc" id="agroup__jwt_html_gadbe8205e986358d27a84259af201e458"><div class="ttname"><a href="group__jwt.html#gadbe8205e986358d27a84259af201e458">r_jwt_serialize_encrypted</a></div><div class="ttdeci">char * r_jwt_serialize_encrypted(jwt_t *jwt, jwk_t *pubkey, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwt.c:1055</div></div>
<div class="ttc" id="agroup__type_html_gga34a92d88d5befd0170a6b82ec53ef020a44cc75e8da8012a15089663a1ca8d7d9"><div class="ttname"><a href="group__type.html#gga34a92d88d5befd0170a6b82ec53ef020a44cc75e8da8012a15089663a1ca8d7d9">R_JWA_ENC_A128CBC</a></div><div class="ttdeci">@ R_JWA_ENC_A128CBC</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:171</div></div>
<div class="ttc" id="agroup__type_html_ggaaf028013558b5ff9aa99ff4afc3ae2eaa8310fea59b4b728f13a561d133f09ba6"><div class="ttname"><a href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaa8310fea59b4b728f13a561d133f09ba6">R_JWA_ALG_RSA1_5</a></div><div class="ttdeci">@ R_JWA_ALG_RSA1_5</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:133</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md19"></a>
Nested JWT</h3>
<p>A nested JWT can be created with Rhonabwy using the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="structjwt__t.html">jwt_t</a> * jwt = NULL;</div>
<div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key = NULL, * jwk_key_sign = NULL;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> payload[] = <span class="stringliteral">&quot;{\&quot;iss\&quot;:\&quot;joe\&quot;,\&quot;exp\&quot;:1300819380,\&quot;http://example.com/is_root\&quot;:true}&quot;</span>,</div>
<div class="line">jwk_pubkey_rsa_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;RSA\&quot;,\&quot;n\&quot;:\&quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKRX&quot;</span>\</div>
<div class="line">                      <span class="stringliteral">&quot;jBZCiFV4n3oknjhMstn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHzu6&quot;</span>\</div>
<div class="line">                      <span class="stringliteral">&quot;qMQvRL5hajrn1n91CbOpbISD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqbw0Ls1jF44-csFCur-kEgU8awapJzKnqDKgw\&quot;&quot;</span>\</div>
<div class="line">                      <span class="stringliteral">&quot;,\&quot;e\&quot;:\&quot;AQAB\&quot;,\&quot;alg\&quot;:\&quot;RS256\&quot;,\&quot;kid\&quot;:\&quot;2011-04-29\&quot;}&quot;</span>,</div>
<div class="line">jwk_key_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;oct\&quot;,\&quot;k\&quot;:\&quot;AyM1SysPpbyDfgZld3umj1qzKObwVMkoqQ-EstJQLr_T-1qS0gZH75aKtMN3Yj0iPS4hcgUuTwjAzZr1Z9CAow\&quot;}&quot;</span>;</div>
<div class="line"><span class="keywordtype">char</span> * token = NULL;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key_sign) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__core.html#gad5d9ca3960b9bf0c07dc1c1cbc8680c2">r_jwt_init</a>(&amp;jwt) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key, jwk_pubkey_rsa_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key_sign, jwk_key_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__jwt.html#ga66a51e0d776df279994d68459020f13c">r_jwt_set_enc_alg</a>(jwt, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaa8310fea59b4b728f13a561d133f09ba6">R_JWA_ALG_RSA1_5</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__jwt.html#gac4ceb3eb242f1382a596622ce3dd8362">r_jwt_set_enc</a>(jwt, <a class="code" href="group__type.html#gga34a92d88d5befd0170a6b82ec53ef020a44cc75e8da8012a15089663a1ca8d7d9">R_JWA_ENC_A128CBC</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__jwt.html#ga05240b4b4653381a11a2878d53aed62a">r_jwt_set_sign_alg</a>(jwt, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaad966cad0ad530e52f7ee6190823e54a3">R_JWA_ALG_HS256</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__jwt.html#ga05240b4b4653381a11a2878d53aed62a">r_jwt_set_sign_alg</a>(jwt, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaad966cad0ad530e52f7ee6190823e54a3">R_JWA_ALG_HS256</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__jwt.html#ga6e302667bc0fb64903fa98bb745171d3">r_jwt_set_full_claims_json_str</a>(jwt, payload) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a>) {</div>
<div class="line">  token = <a class="code" href="group__jwt.html#gade78a3a744664e08ff91b078c92236f1">r_jwt_serialize_nested</a>(jwt, <a class="code" href="group__const.html#ga0ea30b964bf8c7f02c45b7f889c1b541">R_JWT_TYPE_NESTED_SIGN_THEN_ENCRYPT</a>, jwk_key_sign, 0, jwk_key, 0); <span class="comment">// token will store the nested token</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a>(token);</div>
<div class="line"><a class="code" href="group__core.html#ga676cff4810db612ac0047c57ff5eff87">r_jwt_free</a>(jwt);</div>
<div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key);</div>
<div class="ttc" id="agroup__const_html_ga0ea30b964bf8c7f02c45b7f889c1b541"><div class="ttname"><a href="group__const.html#ga0ea30b964bf8c7f02c45b7f889c1b541">R_JWT_TYPE_NESTED_SIGN_THEN_ENCRYPT</a></div><div class="ttdeci">#define R_JWT_TYPE_NESTED_SIGN_THEN_ENCRYPT</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:78</div></div>
<div class="ttc" id="agroup__jwt_html_gade78a3a744664e08ff91b078c92236f1"><div class="ttname"><a href="group__jwt.html#gade78a3a744664e08ff91b078c92236f1">r_jwt_serialize_nested</a></div><div class="ttdeci">char * r_jwt_serialize_nested(jwt_t *jwt, unsigned int type, jwk_t *sign_key, int sign_key_x5u_flags, jwk_t *encrypt_key, int encrypt_key_x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwt.c:1105</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md20"></a>
Parse a JWT</h2>
<p>The functions <code>r_jwt_parse</code> and <code>r_jwt_parsen</code> will parse a serialized JWT. If public keys are present in the header, they will be added to the public keys list and can be used to verify the token signature.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwt.html#gaab6cd5a5b23b79b7213a4918560cfdca">r_jwt_parse</a>(<a class="code" href="structjwt__t.html">jwt_t</a> * jwt, <span class="keyword">const</span> <span class="keywordtype">char</span> * jwt_str, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwt.html#ga7abf7f17814cd45db85ca073287dd188">r_jwt_parsen</a>(<a class="code" href="structjwt__t.html">jwt_t</a> * jwt, <span class="keyword">const</span> <span class="keywordtype">char</span> * jwt_str, <span class="keywordtype">size_t</span> jwt_str_len, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="ttc" id="agroup__jwt_html_ga7abf7f17814cd45db85ca073287dd188"><div class="ttname"><a href="group__jwt.html#ga7abf7f17814cd45db85ca073287dd188">r_jwt_parsen</a></div><div class="ttdeci">int r_jwt_parsen(jwt_t *jwt, const char *token, size_t token_len, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwt.c:1190</div></div>
<div class="ttc" id="agroup__jwt_html_gaab6cd5a5b23b79b7213a4918560cfdca"><div class="ttname"><a href="group__jwt.html#gaab6cd5a5b23b79b7213a4918560cfdca">r_jwt_parse</a></div><div class="ttdeci">int r_jwt_parse(jwt_t *jwt, const char *token, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwt.c:1186</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21"></a>
Advanced parsing</h2>
<p>JWT standard allows to add in the JWT header a public key in several forms:</p><ul>
<li><code>jwk</code>: a public key in JWK format</li>
<li><code>jku</code>: an url to a JWK Set</li>
<li><code>x5c</code>: an array of X509 certificates</li>
<li><code>x5u</code>: an url to a X509 certificate</li>
</ul>
<p>When using the functions <code>r_jwt_parse</code>, <code>r_jwt_parsen</code>, <code>r_jwt_compact_parse</code>, <code>r_jwt_compact_parsen</code>, <code>r_jwt_parse_unsecure</code>, <code>r_jwt_parsen_unsecure</code>, <code>r_jwt_compact_parsen_unsecure</code> and <code>r_jwt_compact_parse_unsecure</code>, by default, if a public key is mentionned in the header, it will be added to the <code>jwt-&gt;jwks_pubkey</code>, so the signature verification will not need to specify a key. This can be dangerous if the token comes from a untrustworthy source and if the token isn't checked properly.</p>
<p>To simplify secure token parsing, you should use the functions <code>r_jwt_advanced_parse[n]</code>:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwt.html#ga107cf283bcaebdfc224121689a823c9e">r_jwt_advanced_parse</a>(<a class="code" href="structjwt__t.html">jwt_t</a> * jwt, <span class="keyword">const</span> <span class="keywordtype">char</span> * token, uint32_t parse_flags, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwt.html#ga813ae27103263124e8bb79a69778d716">r_jwt_advanced_parsen</a>(<a class="code" href="structjwt__t.html">jwt_t</a> * jwt, <span class="keyword">const</span> <span class="keywordtype">char</span> * token, <span class="keywordtype">size_t</span> token_len, uint32_t parse_flags, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="ttc" id="agroup__jwt_html_ga107cf283bcaebdfc224121689a823c9e"><div class="ttname"><a href="group__jwt.html#ga107cf283bcaebdfc224121689a823c9e">r_jwt_advanced_parse</a></div><div class="ttdeci">int r_jwt_advanced_parse(jwt_t *jwt, const char *token, uint32_t parse_flags, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwt.c:1202</div></div>
<div class="ttc" id="agroup__jwt_html_ga813ae27103263124e8bb79a69778d716"><div class="ttname"><a href="group__jwt.html#ga813ae27103263124e8bb79a69778d716">r_jwt_advanced_parsen</a></div><div class="ttdeci">int r_jwt_advanced_parsen(jwt_t *jwt, const char *token, size_t token_len, uint32_t parse_flags, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwt.c:1206</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md22"></a>
Quick parsing</h2>
<p>The quick parsing functions can be used to parse a JWT in one line:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><a class="code" href="structjwt__t.html">jwt_t</a> * <a class="code" href="group__jwt.html#ga0cc038863f977c770017b7ac31d9550d">r_jwt_quick_parse</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * token, uint32_t parse_flags, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="structjwt__t.html">jwt_t</a> * <a class="code" href="group__jwt.html#gaebd0b0bd152a9c9b89fdef0e14571fc8">r_jwt_quick_parsen</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * token, <span class="keywordtype">size_t</span> token_len, uint32_t parse_flags, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="ttc" id="agroup__jwt_html_ga0cc038863f977c770017b7ac31d9550d"><div class="ttname"><a href="group__jwt.html#ga0cc038863f977c770017b7ac31d9550d">r_jwt_quick_parse</a></div><div class="ttdeci">jwt_t * r_jwt_quick_parse(const char *token, uint32_t parse_flags, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwt.c:1312</div></div>
<div class="ttc" id="agroup__jwt_html_gaebd0b0bd152a9c9b89fdef0e14571fc8"><div class="ttname"><a href="group__jwt.html#gaebd0b0bd152a9c9b89fdef0e14571fc8">r_jwt_quick_parsen</a></div><div class="ttdeci">jwt_t * r_jwt_quick_parsen(const char *token, size_t token_len, uint32_t parse_flags, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwt.c:1316</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md23"></a>
Unsecured JWT</h2>
<p>It's possible to use Rhonabwy for unsecured JWT, with the header <code>alg:"none"</code> and an empty signature, using a dedicated set of functions: <code>r_jwt_parse_unsecure</code>, <code>r_jwt_parsen_unsecure</code> and <code>r_jwt_serialize_signed_unsecure</code>, or using <code>r_jwt_advanced_parse</code> with the <code>parse_flags</code> value <code>R_PARSE_UNSIGNED</code> set.</p>
<h3><a class="anchor" id="autotoc_md24"></a>
Parse a unsecured JWT</h3>
<p>By default, the functions <code>r_jwt_parse</code> and <code>r_jwt_parsen</code> will return <code>RHN_ERROR_INVALID</code> if the parsed JWT is unsigned. To parse any JWT, signed or unsigned, you must use the functions <code>r_jwt_parse_unsecure</code> and <code>r_jwt_parsen_unsecure</code>, or using <code>r_jwt_advanced_parse</code> with the <code>parse_flags</code> value <code>R_PARSE_UNSIGNED</code> set.</p>
<h3><a class="anchor" id="autotoc_md25"></a>
Serialize an unsecured JWT</h3>
<p>Use the function <code>r_jwt_serialize_signed_unsecure</code> to serialize an unsecured JWT.</p>
<h3><a class="anchor" id="autotoc_md26"></a>
Signature verification</h3>
<p>The function <code>r_jwt_verify_signature</code> will return <code>RHN_ERROR_INVALID</code> if the JWT is unsecured.</p>
<h3><a class="anchor" id="autotoc_md27"></a>
Nested JWT with an unsecured signature</h3>
<p>It's not possible to serialize or parse a nested JWT with an unsecured signature.</p>
<h1><a class="anchor" id="autotoc_md28"></a>
JWS</h1>
<p>A JWS (JSON Web Signature) is a content digitally signed and serialized in a compact or JSON format that can be easily transferred in HTTP requests.</p>
<p>A compact JWS has 3 elements serialized in base64url format and separated by a dot (.). The 3 elements are:</p>
<ul>
<li>A header in JSON format</li>
<li>A Payload</li>
<li>A digital signature</li>
</ul>
<p>Its representation uses the following format:</p>
<p>BASE64URL(UTF8(JWS Protected Header)) || '.' || BASE64URL(JWS Payload) || '.' || BASE64URL(JWS Signature)</p>
<p>The signature is based on the following data:</p>
<p>BASE64URL(UTF8(JWS Protected Header)) || '.' || BASE64URL(JWS Payload)</p>
<p>The algorithms supported by Rhonabwy are:</p><ul>
<li>HMAC with SHA-2 Functions: <code>HS256</code>, <code>HS384</code>, <code>HS512</code></li>
<li>Digital Signature with RSASSA-PKCS1-v1_5: <code>RS256</code>, <code>RS384</code>, <code>RS512</code></li>
<li>Digital Signature with ECDSA: <code>ES256</code>, <code>ES384</code>, <code>ES512</code>, <code>ES256K</code></li>
<li>Digital Signature with RSASSA-PSS: <code>PS256</code>, <code>PS384</code>, <code>PS512</code></li>
<li>Digital Signature with Ed25519 or Ed448 Elliptic Curve: <code>EDdSA</code></li>
<li>Unsecured: <code>none</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md29"></a>
Set values</h2>
<p>To set the values of the JWS (header, keys, payload, etc.), you can use the dedicated functions (see the documentation), or use the function <code>r_jws_set_properties</code> to set multiple properties at once. The option list MUST end with the option <code>RHN_OPT_NONE</code>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jws.html#ga71ee233e569429145001514c7052d66d">r_jws_set_properties</a>(<a class="code" href="structjws__t.html">jws_t</a> * jws, ...);</div>
<div class="ttc" id="agroup__jws_html_ga71ee233e569429145001514c7052d66d"><div class="ttname"><a href="group__jws.html#ga71ee233e569429145001514c7052d66d">r_jws_set_properties</a></div><div class="ttdeci">int r_jws_set_properties(jws_t *jws,...)</div><div class="ttdef"><b>Definition:</b> jws.c:2043</div></div>
</div><!-- fragment --><p>The available <code>rhn_opt</code> and their following values for a <code><a class="el" href="structjws__t.html">jws_t</a></code> are:</p>
<div class="fragment"><div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0ea0448c1d0c968077dec9b5994d8570">RHN_OPT_HEADER_INT_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">int</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a8517fe52c309d9c4e6d3cff567041626">RHN_OPT_HEADER_RHN_INT_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <a class="code" href="group__type.html#ga6757151c907d670d38e412e623c0309b">rhn_int_t</a></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a502c5d3b3748cd27ff97895c8d6d8405">RHN_OPT_HEADER_STR_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0c0a789329c4c331fa210d5a6f9a2ac5">RHN_OPT_HEADER_JSON_T_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a6a2e0fbadbe28205282a6102d60d15f5">RHN_OPT_HEADER_FULL_JSON_T</a>, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a1a2c54296bfe7135b46ea89a5e5025a4">RHN_OPT_HEADER_FULL_JSON_STR</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ae90f8b7c3c9c82cd1a34001571e2a240">RHN_OPT_PAYLOAD</a>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a088ca2f913481ff69b486b3977c61179">RHN_OPT_SIG_ALG</a>, <a class="code" href="group__type.html#gaaf028013558b5ff9aa99ff4afc3ae2ea">jwa_alg</a></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a7d9f4877070fb37224b3cbb6900b3c14">RHN_OPT_SIGN_KEY_JWK</a>, <a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402aa5ca058c2c0c465ff0699fed1db46abd">RHN_OPT_SIGN_KEY_JWKS</a>, <a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a3804634b86406a1eef280df58bb3402f">RHN_OPT_SIGN_KEY_GNUTLS</a>, gnutls_privkey_t</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a15eaf3170167396aa6daff26b9f018c8">RHN_OPT_SIGN_KEY_JSON_T</a>, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ab445d6fa54b6f04bc100493834b0d983">RHN_OPT_SIGN_KEY_JSON_STR</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a84369d36b933aaecbbba3af453869f78">RHN_OPT_SIGN_KEY_PEM_DER</a>, uint, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a2789a2c85064106bcb0e43433746afe5">RHN_OPT_VERIFY_KEY_JWK</a>, <a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a073305504de0376b363830faa39e6a8c">RHN_OPT_VERIFY_KEY_JWKS</a>, <a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a2a1508af75c9b400453948c650baca91">RHN_OPT_VERIFY_KEY_GNUTLS</a>, gnutls_pubkey_t</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ac72af1210a1c3f48e9c4588698b186a4">RHN_OPT_VERIFY_KEY_JSON_T</a>, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a74e2befc9eaff371d4801b7b7b724cde">RHN_OPT_VERIFY_KEY_JSON_STR</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a7e816f846fa39d7c0ac9a1f669f82864">RHN_OPT_VERIFY_KEY_PEM_DER</a>, uint, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402ae90f8b7c3c9c82cd1a34001571e2a240"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402ae90f8b7c3c9c82cd1a34001571e2a240">RHN_OPT_PAYLOAD</a></div><div class="ttdeci">@ RHN_OPT_PAYLOAD</div><div class="ttdoc">JSON value to set the entire payload, following parameters must be const unsigned char * value,...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:189</div></div>
</div><!-- fragment --><p>Example of usage for <code>r_jws_set_properties</code>:</p>
<div class="fragment"><div class="line"><a class="code" href="structjws__t.html">jws_t</a> * jws;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> payload[] = {4, 8, 15, 16, 23, 42};</div>
<div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk; <span class="comment">// Set a private RSA key in this value</span></div>
<div class="line"><a class="code" href="group__jws.html#ga71ee233e569429145001514c7052d66d">r_jws_set_properties</a>(jws, <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0ea0448c1d0c968077dec9b5994d8570">RHN_OPT_HEADER_INT_VALUE</a>, <span class="stringliteral">&quot;int&quot;</span>, 42,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a502c5d3b3748cd27ff97895c8d6d8405">RHN_OPT_HEADER_STR_VALUE</a>, <span class="stringliteral">&quot;str&quot;</span>, <span class="stringliteral">&quot;a value&quot;</span>,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0c0a789329c4c331fa210d5a6f9a2ac5">RHN_OPT_HEADER_JSON_T_VALUE</a>, <span class="stringliteral">&quot;json&quot;</span>, json_true(),</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ae90f8b7c3c9c82cd1a34001571e2a240">RHN_OPT_PAYLOAD</a>, payload, <span class="keyword">sizeof</span>(payload),</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a088ca2f913481ff69b486b3977c61179">RHN_OPT_SIG_ALG</a>, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaaaf2f117cfb4fea32399b19f684d87451">R_JWA_ALG_RS256</a>,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a7d9f4877070fb37224b3cbb6900b3c14">RHN_OPT_SIGN_KEY_JWK</a>, jwk,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402add9d6beaac445b88123fa1554cb05f66">RHN_OPT_NONE</a>); <span class="comment">// Test if return value is RHN_OK</span></div>
<div class="line"><span class="keywordtype">char</span> * token = <a class="code" href="group__jws.html#gaaca013bc2c9c3fe1e85386187504b235">r_jws_serialize</a>(jws, NULL, 0);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__jws_html_gaaca013bc2c9c3fe1e85386187504b235"><div class="ttname"><a href="group__jws.html#gaaca013bc2c9c3fe1e85386187504b235">r_jws_serialize</a></div><div class="ttdeci">char * r_jws_serialize(jws_t *jws, jwk_t *jwk_privkey, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jws.c:1870</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md30"></a>
JWS example</h2>
<p>In this example, the payload used is the following message:</p>
<div class="fragment"><div class="line">The true sign of intelligence is not knowledge but imagination.</div>
</div><!-- fragment --><p>The JWS will be signed using HMAC with SHA256 algorithm, in this example, the signing process will use a key identified by the kid "1", therefore the header is the following:</p>
<div class="fragment"><div class="line">{&quot;alg&quot;:&quot;HS256&quot;,&quot;kid&quot;:&quot;1&quot;}</div>
</div><!-- fragment --><p>The key used to sign the data is:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;kty&quot;:&quot;oct&quot;,</div>
<div class="line">  &quot;alg&quot;:&quot;HS256&quot;,</div>
<div class="line">  &quot;k&quot;:&quot;c2VjcmV0&quot;,</div>
<div class="line">  &quot;kid&quot;:&quot;1&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Finally, the complete representation of the JWS is the following:</p>
<div class="fragment"><div class="line">eyJhbGciOiJIUzI1NiIsImtpZCI6IjEifQ.VGhlIHRydWUgc2lnbiBvZiBpbnRlbGxpZ2VuY2UgaXMgbm90IGtub3dsZWRnZSBidXQgaW1hZ2luYXRpb24u.GKxWqRBFr-6X4HfflzGeGvKVsJ8v1-J39Ho2RslC-5o</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31"></a>
Serialize a JWS using Rhonabwy in compact mode</h2>
<p>The JWS above can be created with the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="structjws__t.html">jws_t</a> * jws = NULL;</div>
<div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key_symmetric = NULL;</div>
<div class="line"><span class="keywordtype">char</span> * token = NULL;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> payload[] = <span class="stringliteral">&quot;The true sign of intelligence is not knowledge but imagination.&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> jwk_key_symmetric_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;oct\&quot;,\&quot;alg\&quot;:\&quot;HS256\&quot;,\&quot;k\&quot;:\&quot;c2VjcmV0\&quot;,\&quot;kid\&quot;:\&quot;1\&quot;}&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key_symmetric) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__core.html#ga365c9ed016d8034d1bc5a00b686c859b">r_jws_init</a>(&amp;jws) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key_symmetric, jwk_key_symmetric_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__jws.html#gaec9fca6a5ba8aa2fe7077b127464e428">r_jws_set_alg</a>(jws, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaad966cad0ad530e52f7ee6190823e54a3">R_JWA_ALG_HS256</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__jws.html#gad0aa1c6b7fa0b8d34028059b5770fc01">r_jws_set_payload</a>(jws, payload, <span class="keyword">sizeof</span>(payload)) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a>) {</div>
<div class="line">  token = <a class="code" href="group__jws.html#gaaca013bc2c9c3fe1e85386187504b235">r_jws_serialize</a>(jws, jwk_key_symmetric, 0); <span class="comment">// token will store the signed token</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a>(token);</div>
<div class="line"><a class="code" href="group__core.html#ga4f008bda5b951380b6eaa99d35779d64">r_jws_free</a>(jws);</div>
<div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key_symmetric);</div>
<div class="ttc" id="agroup__jws_html_gad0aa1c6b7fa0b8d34028059b5770fc01"><div class="ttname"><a href="group__jws.html#gad0aa1c6b7fa0b8d34028059b5770fc01">r_jws_set_payload</a></div><div class="ttdeci">int r_jws_set_payload(jws_t *jws, const unsigned char *payload, size_t payload_len)</div><div class="ttdef"><b>Definition:</b> jws.c:930</div></div>
<div class="ttc" id="agroup__jws_html_gaec9fca6a5ba8aa2fe7077b127464e428"><div class="ttname"><a href="group__jws.html#gaec9fca6a5ba8aa2fe7077b127464e428">r_jws_set_alg</a></div><div class="ttdeci">int r_jws_set_alg(jws_t *jws, jwa_alg alg)</div><div class="ttdef"><b>Definition:</b> jws.c:965</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md32"></a>
Parse and validate signature of a JWS using Rhonabwy</h2>
<p>The JWS above can be parsed and verified using the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="structjws__t.html">jws_t</a> * jws = NULL;</div>
<div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key_symmetric = NULL;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> token[] = <span class="stringliteral">&quot;eyJhbGciOiJIUzI1NiIsImtpZCI6IjEifQ.&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;VGhlIHRydWUgc2lnbiBvZiBpbnRlbGxpZ2VuY2UgaXMgbm90IGtub3dsZWRnZSBidXQgaW1hZ2luYXRpb24u.&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;GKxWqRBFr-6X4HfflzGeGvKVsJ8v1-J39Ho2RslC-5o&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> jwk_key_symmetric_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;oct\&quot;,\&quot;alg\&quot;:\&quot;HS256\&quot;,\&quot;k\&quot;:\&quot;c2VjcmV0\&quot;,\&quot;kid\&quot;:\&quot;1\&quot;}&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * payload = NULL;</div>
<div class="line"><span class="keywordtype">size_t</span> payload_len = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key_symmetric) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__core.html#ga365c9ed016d8034d1bc5a00b686c859b">r_jws_init</a>(&amp;jws) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key_symmetric, jwk_key_symmetric_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__jws.html#gae1b043a46071322f988c8d714883a208">r_jws_parse</a>(jws, token, 0) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__jws.html#ga2f4b76d9600759ef920c0d389ae19fda">r_jws_verify_signature</a>(jws, jwk_key_symmetric, 0) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    (payload = <a class="code" href="group__jws.html#ga6373deaab8fecce87cc7adc44062ca91">r_jws_get_payload</a>(jws, &amp;payload_len)) != NULL &amp;&amp; payload_len &gt; 0) {</div>
<div class="line">    <span class="comment">// payload and payload_len will contain the payload data</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__core.html#ga4f008bda5b951380b6eaa99d35779d64">r_jws_free</a>(jws);</div>
<div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key_symmetric);</div>
<div class="ttc" id="agroup__jws_html_ga2f4b76d9600759ef920c0d389ae19fda"><div class="ttname"><a href="group__jws.html#ga2f4b76d9600759ef920c0d389ae19fda">r_jws_verify_signature</a></div><div class="ttdeci">int r_jws_verify_signature(jws_t *jws, jwk_t *jwk_pubkey, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jws.c:1778</div></div>
<div class="ttc" id="agroup__jws_html_ga6373deaab8fecce87cc7adc44062ca91"><div class="ttname"><a href="group__jws.html#ga6373deaab8fecce87cc7adc44062ca91">r_jws_get_payload</a></div><div class="ttdeci">const unsigned char * r_jws_get_payload(jws_t *jws, size_t *payload_len)</div><div class="ttdef"><b>Definition:</b> jws.c:955</div></div>
<div class="ttc" id="agroup__jws_html_gae1b043a46071322f988c8d714883a208"><div class="ttname"><a href="group__jws.html#gae1b043a46071322f988c8d714883a208">r_jws_parse</a></div><div class="ttdeci">int r_jws_parse(jws_t *jws, const char *jws_str, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jws.c:1381</div></div>
</div><!-- fragment --><p>The functions <code>r_jws_parse</code>, <code>r_jws_parsen</code>, <code>r_jws_compact_parse</code> and <code>r_jws_compact_parsen</code> will parse a serialized JWS. If public keys are present in the header, they will be added to the public keys list and can be used to verify the token signature.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jws.html#gae1b043a46071322f988c8d714883a208">r_jws_parse</a>(<a class="code" href="structjws__t.html">jws_t</a> * jws, <span class="keyword">const</span> <span class="keywordtype">char</span> * jws_str, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jws.html#ga9bfab9e913d1fb5b531c585ebcd054c0">r_jws_parsen</a>(<a class="code" href="structjws__t.html">jws_t</a> * jws, <span class="keyword">const</span> <span class="keywordtype">char</span> * jws_str, <span class="keywordtype">size_t</span> jws_str_len, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="ttc" id="agroup__jws_html_ga9bfab9e913d1fb5b531c585ebcd054c0"><div class="ttname"><a href="group__jws.html#ga9bfab9e913d1fb5b531c585ebcd054c0">r_jws_parsen</a></div><div class="ttdeci">int r_jws_parsen(jws_t *jws, const char *jws_str, size_t jws_str_len, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jws.c:1385</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md33"></a>
Compressed payload</h3>
<p>The header value <code>"zip":"DEF"</code> is used to specify if the JWS payload is compressed using <a href="https://tools.ietf.org/html/rfc7516#section-4.1.3">ZIP/Deflate</a> algorithm. Rhonabwy will automatically compress or decompress the decrypted payload during serialization or parse process.</p>
<h2><a class="anchor" id="autotoc_md34"></a>
Unsecured JWS</h2>
<p>It's possible to use Rhonabwy for unsecured JWS, with the header <code>alg:"none"</code> and an empty signature, using a dedicated set of functions: <code>r_jws_parse_unsecure</code>, <code>r_jws_parsen_unsecure</code>, <code>r_jws_compact_parsen_unsecure</code>, <code>r_jws_compact_parse_unsecure</code> and <code>r_jws_serialize_unsecure</code>, or using <code>r_jws_advanced_parse</code> with the <code>parse_flags</code> value <code>R_PARSE_UNSIGNED</code> set.</p>
<h3><a class="anchor" id="autotoc_md35"></a>
Parse a unsecured JWS</h3>
<p>By default, the functions <code>r_jws_parse</code>, <code>r_jws_parsen</code>, <code>r_jws_compact_parse</code> and <code>r_jws_compact_parsen</code> will return <code>RHN_ERROR_INVALID</code> if the parsed JWS is unsigned. To parse any JWS, signed or unsigned, you must use the functions <code>r_jws_parse_unsecure</code>, <code>r_jws_parsen_unsecure</code>, <code>r_jws_compact_parsen_unsecure</code> and <code>r_jws_compact_parse_unsecure</code>, or using <code>r_jws_advanced_parse</code> with the <code>parse_flags</code> value <code>R_PARSE_UNSIGNED</code> set.</p>
<h3><a class="anchor" id="autotoc_md36"></a>
Serialize an unsecured JWS</h3>
<p>Use the function <code>r_jws_serialize_unsecure</code> to serialize an unsecured JWS. By design, the functions <code>r_jws_serialize_json_t</code> and <code>r_jws_serialize_json_str</code> will return NULL with mode <code>R_JSON_MODE_FLATTENED</code> on unsecured JWS.</p>
<h2><a class="anchor" id="autotoc_md37"></a>
Advanced parsing</h2>
<p>JWS standard allows to add in the JWS header a public key in several forms:</p><ul>
<li><code>jwk</code>: a public key in JWK format</li>
<li><code>jku</code>: an url to a JWK Set</li>
<li><code>x5c</code>: an array of X509 certificates</li>
<li><code>x5u</code>: an url to a X509 certificate</li>
</ul>
<p>When using the functions <code>r_jws_parse</code>, <code>r_jws_parsen</code>, <code>r_jws_compact_parse</code>, <code>r_jws_compact_parsen</code>, <code>r_jws_parse_unsecure</code>, <code>r_jws_parsen_unsecure</code>, <code>r_jws_compact_parsen_unsecure</code> and <code>r_jws_compact_parse_unsecure</code>, by default, if a public key is mentionned in the header, it will be added to the <code>jws-&gt;jwks_pubkey</code>, so the signature verification will not need to specify a key. This can be dangerous if the token comes from a untrustworthy source and if the token isn't checked properly.</p>
<p>To simplify secure token parsing, you should use the functions <code>r_jws_advanced_parse[n]</code>:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jws.html#ga90fc421f2b73a5ce3d853c37a470d553">r_jws_advanced_parse</a>(<a class="code" href="structjws__t.html">jws_t</a> * jws, <span class="keyword">const</span> <span class="keywordtype">char</span> * jws_str, uint32_t parse_flags, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jws.html#ga8bb81b8df3f303d296268e326ad172eb">r_jws_advanced_parsen</a>(<a class="code" href="structjws__t.html">jws_t</a> * jws, <span class="keyword">const</span> <span class="keywordtype">char</span> * jws_str, <span class="keywordtype">size_t</span> jws_str_len, uint32_t parse_flags, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="ttc" id="agroup__jws_html_ga8bb81b8df3f303d296268e326ad172eb"><div class="ttname"><a href="group__jws.html#ga8bb81b8df3f303d296268e326ad172eb">r_jws_advanced_parsen</a></div><div class="ttdeci">int r_jws_advanced_parsen(jws_t *jws, const char *jws_str, size_t jws_str_len, uint32_t parse_flags, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jws.c:1401</div></div>
<div class="ttc" id="agroup__jws_html_ga90fc421f2b73a5ce3d853c37a470d553"><div class="ttname"><a href="group__jws.html#ga90fc421f2b73a5ce3d853c37a470d553">r_jws_advanced_parse</a></div><div class="ttdeci">int r_jws_advanced_parse(jws_t *jws, const char *jws_str, uint32_t parse_flags, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jws.c:1397</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md38"></a>
Quick parsing</h2>
<p>The quick parsing functions can be used to parse a JWS in one line:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><a class="code" href="structjws__t.html">jws_t</a> * <a class="code" href="group__jws.html#gaa53ab48b2da3dfc54e4d5f8a010a4ffb">r_jws_quick_parse</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * jws_str, uint32_t parse_flags, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="structjws__t.html">jws_t</a> * <a class="code" href="group__jws.html#ga8f07882675d9608eb8066586b48c5991">r_jws_quick_parsen</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * jws_str, <span class="keywordtype">size_t</span> jws_str_len, uint32_t parse_flags, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="ttc" id="agroup__jws_html_ga8f07882675d9608eb8066586b48c5991"><div class="ttname"><a href="group__jws.html#ga8f07882675d9608eb8066586b48c5991">r_jws_quick_parsen</a></div><div class="ttdeci">jws_t * r_jws_quick_parsen(const char *jws_str, size_t jws_str_len, uint32_t parse_flags, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jws.c:1761</div></div>
<div class="ttc" id="agroup__jws_html_gaa53ab48b2da3dfc54e4d5f8a010a4ffb"><div class="ttname"><a href="group__jws.html#gaa53ab48b2da3dfc54e4d5f8a010a4ffb">r_jws_quick_parse</a></div><div class="ttdeci">jws_t * r_jws_quick_parse(const char *jws_str, uint32_t parse_flags, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jws.c:1757</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md39"></a>
Signature verification</h3>
<p>Signature verification is provided by the function <code>r_jws_verify_signature</code> which has the following definition:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jws.html#ga2f4b76d9600759ef920c0d389ae19fda">r_jws_verify_signature</a>(<a class="code" href="structjws__t.html">jws_t</a> * jws, <a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_pubkey, <span class="keywordtype">int</span> x5u_flags);</div>
</div><!-- fragment --><p>The function <code>r_jws_verify_signature</code> will return <code>RHN_ERROR_INVALID</code> if the JWS is unsecured.</p>
<h1><a class="anchor" id="autotoc_md40"></a>
JWE</h1>
<p>A JWE (JSON Web Encryption) is an encrypted content serialized in a compact format that can be easily transferred in HTTP requests.</p>
<p>Basically the payload is encrypted using AES-CBC or AES-GCM and an Initialization Vector (IV), a authentication tag is generated to validate the decryption, and the AES key used to encrypt the payload is encrypted itself using a symmetric or asymmetric encryption algorithm.</p>
<p>The serialized token has the following format:</p>
<p>BASE64URL(UTF8(JWE Protected Header)) || '.' || BASE64URL(JWE Encrypted Key) || '.' || BASE64URL(JWE Initialization Vector) || '.' || BASE64URL(JWE Ciphertext) || '.' || BASE64URL(JWE Authentication Tag)</p>
<p>In Rhonabwy library, the supported algorithms are:</p><ul>
<li>Supported Encryption Algorithm (<code>enc</code>) for JWE payload encryption: <code>A128CBC-HS256</code>, <code>A192CBC-HS384</code>, <code>A256CBC-HS512</code>, <code>A128GCM</code>, <code>A2192GCM</code>, <code>A256GCM</code></li>
<li>Supported Cryptographic Algorithms for Key Management: <code>RSA1_5</code> (RSAES-PKCS1-v1_5), <code>RSA-OAEP</code>, <code>RSA-OAEP-256</code>, <code>A128KW</code>, <code>A192KW</code>, <code>A256KW</code>, <code>dir</code> (Direct use of a shared symmetric key), <code>A128GCMKW</code>, <code>A192GCMKW</code>, <code>A256GCMKW</code>, <code>ECDH-ES</code>, <code>ECDH-ES+A128KW</code>, <code>ECDH-ES+A192KW</code>, <code>ECDH-ES+A256KW</code>, <code>PBES2-HS384+A192KW</code> and <code>PBES2-HS512+A256KW</code>, <code>PBES2-HS256+A128KW</code></li>
</ul>
<p>If you don't specify a Content Encryption Key or an Initialization Vector before the serialization, Rhonabwy will automatically generate one or the other or both depending on the algorithm specified.</p>
<h2><a class="anchor" id="autotoc_md41"></a>
Set values</h2>
<p>To set the values of the JWE (header, keys, payload, etc.), you can use the dedicated functions (see the documentation), or use the function <code>r_jwe_set_properties</code> to set multiple properties at once. The option list MUST end with the option <code>RHN_OPT_NONE</code>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__jwe.html#ga0a43a8f4a36436643cac91ad5266f93d">r_jwe_set_properties</a>(<a class="code" href="structjwe__t.html">jwe_t</a> * jwe, ...);</div>
<div class="ttc" id="agroup__jwe_html_ga0a43a8f4a36436643cac91ad5266f93d"><div class="ttname"><a href="group__jwe.html#ga0a43a8f4a36436643cac91ad5266f93d">r_jwe_set_properties</a></div><div class="ttdeci">int r_jwe_set_properties(jwe_t *jwe,...)</div><div class="ttdef"><b>Definition:</b> jwe.c:4470</div></div>
</div><!-- fragment --><p>The available <code>rhn_opt</code> and their following values for a <code><a class="el" href="structjwe__t.html">jwe_t</a></code> are:</p>
<div class="fragment"><div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0ea0448c1d0c968077dec9b5994d8570">RHN_OPT_HEADER_INT_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">int</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a8517fe52c309d9c4e6d3cff567041626">RHN_OPT_HEADER_RHN_INT_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <a class="code" href="group__type.html#ga6757151c907d670d38e412e623c0309b">rhn_int_t</a></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a502c5d3b3748cd27ff97895c8d6d8405">RHN_OPT_HEADER_STR_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0c0a789329c4c331fa210d5a6f9a2ac5">RHN_OPT_HEADER_JSON_T_VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a6a2e0fbadbe28205282a6102d60d15f5">RHN_OPT_HEADER_FULL_JSON_T</a>, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a1a2c54296bfe7135b46ea89a5e5025a4">RHN_OPT_HEADER_FULL_JSON_STR</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ae90f8b7c3c9c82cd1a34001571e2a240">RHN_OPT_PAYLOAD</a>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ac2374e1b6b62a3b07197c52a93f925a6">RHN_OPT_ENC_ALG</a>, <a class="code" href="group__type.html#gaaf028013558b5ff9aa99ff4afc3ae2ea">jwa_alg</a></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ad5e5eaa26dfc6cb43c2a5787e5382d31">RHN_OPT_ENC</a>, <a class="code" href="group__type.html#ga34a92d88d5befd0170a6b82ec53ef020">jwa_enc</a></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a75cbb9a6c8895781e8045323953f29ef">RHN_OPT_CIPHER_KEY</a>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a82a19cbd2d2579513b9ea8d7c0e4f858">RHN_OPT_IV</a>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a66644b8bd21495f6cf354f9fbe2cf926">RHN_OPT_AAD</a>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402aec7ea054ff0b0262ad4f755896a23bca">RHN_OPT_ENCRYPT_KEY_JWK</a>, <a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402aec369cd6472feadfeeb70f0c4b9f95de">RHN_OPT_ENCRYPT_KEY_JWKS</a>, <a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a28e6000e49f87a835dfe58825c9cbedc">RHN_OPT_ENCRYPT_KEY_GNUTLS</a>, gnutls_pubkey_t</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a16f4eea7c6035ad8311509d23950f8d2">RHN_OPT_ENCRYPT_KEY_JSON_T</a>, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a216199ac195850890a96299cfb4d147f">RHN_OPT_ENCRYPT_KEY_JSON_STR</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a5320c4edd278e1a945147c7a87d44310">RHN_OPT_ENCRYPT_KEY_PEM_DER</a>, uint, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a12049510fcaef29c2ef4d1b95245bf06">RHN_OPT_DECRYPT_KEY_JWK</a>, <a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a1a446f5001dfca1674a7d0f5193c8b01">RHN_OPT_DECRYPT_KEY_JWKS</a>, <a class="code" href="group__type.html#gad1e7e9d151ac27e89f550389ee397494">jwks_t</a> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402acd9f2decb365f6e9d52e035c8af21a5c">RHN_OPT_DECRYPT_KEY_GNUTLS</a>, gnutls_privkey_t</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a875eddf1c2db86da4e021f390affaa0c">RHN_OPT_DECRYPT_KEY_JSON_T</a>, json_t *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a28baf76e56201b3c71c431948e812733">RHN_OPT_DECRYPT_KEY_JSON_STR</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402aa2b6f594db59a1c3448a1c830d39da70">RHN_OPT_DECRYPT_KEY_PEM_DER</a>, uint, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *, <span class="keywordtype">size_t</span></div>
<div class="ttc" id="agroup__type_html_gga37e05440364473c9a0ce205ea0013402a66644b8bd21495f6cf354f9fbe2cf926"><div class="ttname"><a href="group__type.html#gga37e05440364473c9a0ce205ea0013402a66644b8bd21495f6cf354f9fbe2cf926">RHN_OPT_AAD</a></div><div class="ttdeci">@ RHN_OPT_AAD</div><div class="ttdoc">Additional Authenticated Data (AAD) for data encryption, following parameters must be const unsigned ...</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:201</div></div>
</div><!-- fragment --><p>Example of usage for <code>r_jwe_set_properties</code>:</p>
<div class="fragment"><div class="line"><a class="code" href="structjwe__t.html">jwe_t</a> * jwe;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> payload[] = {4, 8, 15, 16, 23, 42};</div>
<div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk; <span class="comment">// Set a public RSA key in this value</span></div>
<div class="line"><a class="code" href="group__jwe.html#ga0a43a8f4a36436643cac91ad5266f93d">r_jwe_set_properties</a>(jwe, <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0ea0448c1d0c968077dec9b5994d8570">RHN_OPT_HEADER_INT_VALUE</a>, <span class="stringliteral">&quot;int&quot;</span>, 42,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a502c5d3b3748cd27ff97895c8d6d8405">RHN_OPT_HEADER_STR_VALUE</a>, <span class="stringliteral">&quot;str&quot;</span>, <span class="stringliteral">&quot;a value&quot;</span>,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402a0c0a789329c4c331fa210d5a6f9a2ac5">RHN_OPT_HEADER_JSON_T_VALUE</a>, <span class="stringliteral">&quot;json&quot;</span>, json_true(),</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ae90f8b7c3c9c82cd1a34001571e2a240">RHN_OPT_PAYLOAD</a>, payload, <span class="keyword">sizeof</span>(payload),</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ac2374e1b6b62a3b07197c52a93f925a6">RHN_OPT_ENC_ALG</a>, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaa92a9d1ac9562223ef7326a1f004256d1">R_JWA_ALG_RSA_OAEP_256</a>,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402ad5e5eaa26dfc6cb43c2a5787e5382d31">RHN_OPT_ENC</a>, <a class="code" href="group__type.html#gga34a92d88d5befd0170a6b82ec53ef020a449007d1ef57dd34cf5d7c28070d5fc2">R_JWA_ENC_A128GCM</a>,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402aec7ea054ff0b0262ad4f755896a23bca">RHN_OPT_ENCRYPT_KEY_JWK</a>, jwk,</div>
<div class="line">                          <a class="code" href="group__type.html#gga37e05440364473c9a0ce205ea0013402add9d6beaac445b88123fa1554cb05f66">RHN_OPT_NONE</a>); <span class="comment">// Test if return value is RHN_OK</span></div>
<div class="line"><span class="keywordtype">char</span> * token = <a class="code" href="group__jwe.html#gae9d1ad8e969eb23794dcce3f78a1aa1f">r_jwe_serialize</a>(jwe, NULL, 0);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__jwe_html_gae9d1ad8e969eb23794dcce3f78a1aa1f"><div class="ttname"><a href="group__jwe.html#gae9d1ad8e969eb23794dcce3f78a1aa1f">r_jwe_serialize</a></div><div class="ttdeci">char * r_jwe_serialize(jwe_t *jwe, jwk_t *jwk_pubkey, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwe.c:4202</div></div>
<div class="ttc" id="agroup__type_html_gga34a92d88d5befd0170a6b82ec53ef020a449007d1ef57dd34cf5d7c28070d5fc2"><div class="ttname"><a href="group__type.html#gga34a92d88d5befd0170a6b82ec53ef020a449007d1ef57dd34cf5d7c28070d5fc2">R_JWA_ENC_A128GCM</a></div><div class="ttdeci">@ R_JWA_ENC_A128GCM</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:174</div></div>
<div class="ttc" id="agroup__type_html_ggaaf028013558b5ff9aa99ff4afc3ae2eaa92a9d1ac9562223ef7326a1f004256d1"><div class="ttname"><a href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaa92a9d1ac9562223ef7326a1f004256d1">R_JWA_ALG_RSA_OAEP_256</a></div><div class="ttdeci">@ R_JWA_ALG_RSA_OAEP_256</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:135</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md42"></a>
JWE example</h2>
<p>In this example, the payload used is the following message:</p>
<div class="fragment"><div class="line">The true sign of intelligence is not knowledge but imagination.</div>
</div><!-- fragment --><p>The RSA private key associated to this token is:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;kty&quot;:&quot;RSA&quot;,</div>
<div class="line">  &quot;n&quot;:&quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKRXjBZCiFV4n3oknjhMstn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHzu6qMQvRL5hajrn1n91CbOpbISD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqbw0Ls1jF44-csFCur-kEgU8awapJzKnqDKgw&quot;,</div>
<div class="line">  &quot;e&quot;:&quot;AQAB&quot;,</div>
<div class="line">  &quot;d&quot;:&quot;X4cTteJY_gn4FYPsXB8rdXix5vwsg1FLN5E3EaG6RJoVH-HLLKD9M7dx5oo7GURknchnrRweUkC7hT5fJLM0WbFAKNLWY2vv7B6NqXSzUvxT0_YSfqijwp3RTzlBaCxWp4doFk5N2o8Gy_nHNKroADIkJ46pRUohsXywbReAdYaMwFs9tv8d_cPVY3i07a3t8MN6TNwm0dSawm9v47UiCl3Sk5ZiG7xojPLu4sbg1U2jx4IBTNBznbJSzFHK66jT8bgkuqsk0GjskDJk19Z4qwjwbsnn4j2WBii3RL-Us2lGVkY8fkFzme1z0HbIkfz0Y6mqnOYtqc0X4jfcKoAC8Q&quot;,</div>
<div class="line">  &quot;p&quot;:&quot;83i-7IvMGXoMXCskv73TKr8637FiO7Z27zv8oj6pbWUQyLPQBQxtPVnwD20R-60eTDmD2ujnMt5PoqMrm8RfmNhVWDtjjMmCMjOpSXicFHj7XOuVIYQyqVWlWEh6dN36GVZYk93N8Bc9vY41xy8B9RzzOGVQzXvNEvn7O0nVbfs&quot;,&quot;q&quot;:&quot;3dfOR9cuYq-0S-mkFLzgItgMEfFzB2q3hWehMuG0oCuqnb3vobLyumqjVZQO1dIrdwgTnCdpYzBcOfW5r370AFXjiWft_NGEiovonizhKpo9VVS78TzFgxkIdrecRezsZ-1kYd_s1qDbxtkDEgfAITAG9LUnADun4vIcb6yelxk&quot;,</div>
<div class="line">  &quot;dp&quot;:&quot;G4sPXkc6Ya9y8oJW9_ILj4xuppu0lzi_H7VTkS8xj5SdX3coE0oimYwxIi2emTAue0UOa5dpgFGyBJ4c8tQ2VF402XRugKDTP8akYhFo5tAA77Qe_NmtuYZc3C3m3I24G2GvR5sSDxUyAN2zq8Lfn9EUms6rY3Ob8YeiKkTiBj0&quot;,&quot;dq&quot;:&quot;s9lAH9fggBsoFR8Oac2R_E2gw282rT2kGOAhvIllETE1efrA6huUUvMfBcMpn8lqeW6vzznYY5SSQF7pMdC_agI3nG8Ibp1BUb0JUiraRNqUfLhcQb_d9GF4Dh7e74WbRsobRonujTYN1xCaP6TO61jvWrX-L18txXw494Q_cgk&quot;,</div>
<div class="line">  &quot;qi&quot;:&quot;GyM_p6JrXySiz1toFgKbWV-JdI3jQ4ypu9rbMWx3rQJBfmt0FoYzgUIZEVFEcOqwemRN81zoDAaa-Bk0KWNGDjJHZDdDmFhW3AN7lI-puxk_mHZGJ11rxyR8O55XLSe3SPmRfKwZI6yU24ZxvQKFYItdldUKGzO6Ia6zTKhAVRU&quot;,</div>
<div class="line">  &quot;kid&quot;:&quot;2011-04-29&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The encryption algorithm used is <code>A128CBC-HS256</code> and the cryptographic algorithm to encrypt the key is <code>RSA1_5</code></p>
<p>Finally, the complete representation of the JWE is:</p>
<div class="fragment"><div class="line">eyJhbGciOiJSU0ExXzUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.0ouvmluqT8kvBCgjMw8mhBFFEI5Rua58WnnATU21RqEQ2f9M6FqGEkgYpJ81ePtTkOyW1l8V-4nxIDxy-xeTHd0v5bDEbxhWKRdOmUHACC018Gt1ZB9EHHJt7k4UYj3up2xVa8qykKbZ3WGF0Gffi6ctfLCfRCWNnXMbAylV02mf4Tfhpad_WC4EeZENNryilXbAKD_9NNje-CoXD0IQK4-z2fkzfyUislwzK7dyz--uNNAC3N6XO3Blr_z61wXWGEHBa62fyHCsQqagAzN_MqTZv6cxOpRpeWM4_SwjjvcyC77rRyVpN0lC9ukyX_pNrGLXW8zH4mH78OcKPoDLPw.o5e-xb5ZzvZA2JYD2qgFbA.YNTPRS7Hv0fqE7ReEUAS_KNM31wMPPldhBGmYuQTzUWVcX8pGqooTbwaV4o_7BBiF4apD_VCGWwQ-fDD0eDofg.uyAjCu7WSo8BeBDFmYfkLA</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md43"></a>
Serialize a JWE using Rhonabwy</h2>
<p>The JWE above can be created with the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="structjwe__t.html">jwe_t</a> * jwe = NULL;</div>
<div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key_rsa = NULL;</div>
<div class="line"><span class="keywordtype">char</span> * token = NULL;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> payload[] = <span class="stringliteral">&quot;The true sign of intelligence is not knowledge but imagination.&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> jwk_pubkey_rsa_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;RSA\&quot;,\&quot;n\&quot;:\&quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKRX&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;jBZCiFV4n3oknjhMstn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHzu6&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;qMQvRL5hajrn1n91CbOpbISD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqbw0Ls1jF44-csFCur-kEgU8awapJzKnqDKgw\&quot;&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;,\&quot;e\&quot;:\&quot;AQAB\&quot;,\&quot;alg\&quot;:\&quot;RS256\&quot;,\&quot;kid\&quot;:\&quot;2011-04-29\&quot;}&quot;</span>,</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key_rsa) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__core.html#ga9fe136eb9a9a8c256f4cdb091c14da52">r_jwe_init</a>(&amp;jwe) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key_rsa, jwk_pubkey_rsa_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__jwe.html#ga4970779790d672fee843abd87c0df229">r_jwe_set_alg</a>(jwe, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaa8310fea59b4b728f13a561d133f09ba6">R_JWA_ALG_RSA1_5</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__jwe.html#ga326f844d28010d3e7396f913a34e26fb">r_jwe_set_enc</a>(jwe, <a class="code" href="group__type.html#gga34a92d88d5befd0170a6b82ec53ef020a44cc75e8da8012a15089663a1ca8d7d9">R_JWA_ENC_A128CBC</a>) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__jwe.html#ga31e487c9e934bfe7a988cebcf6d24dc9">r_jwe_set_payload</a>(jwe, payload, <span class="keyword">sizeof</span>(payload)) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a>) {</div>
<div class="line">  token = <a class="code" href="group__jwe.html#gae9d1ad8e969eb23794dcce3f78a1aa1f">r_jwe_serialize</a>(jwe, jwk_key_rsa, 0); <span class="comment">// token will store the encrypted token</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a>(token);</div>
<div class="line"><a class="code" href="group__core.html#ga14172c6cf13d0e96abf27d660d87037b">r_jwe_free</a>(jwe);</div>
<div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key_rsa);</div>
<div class="ttc" id="agroup__jwe_html_ga31e487c9e934bfe7a988cebcf6d24dc9"><div class="ttname"><a href="group__jwe.html#ga31e487c9e934bfe7a988cebcf6d24dc9">r_jwe_set_payload</a></div><div class="ttdeci">int r_jwe_set_payload(jwe_t *jwe, const unsigned char *payload, size_t payload_len)</div><div class="ttdef"><b>Definition:</b> jwe.c:2793</div></div>
<div class="ttc" id="agroup__jwe_html_ga326f844d28010d3e7396f913a34e26fb"><div class="ttname"><a href="group__jwe.html#ga326f844d28010d3e7396f913a34e26fb">r_jwe_set_enc</a></div><div class="ttdeci">int r_jwe_set_enc(jwe_t *jwe, jwa_enc enc)</div><div class="ttdef"><b>Definition:</b> jwe.c:3041</div></div>
<div class="ttc" id="agroup__jwe_html_ga4970779790d672fee843abd87c0df229"><div class="ttname"><a href="group__jwe.html#ga4970779790d672fee843abd87c0df229">r_jwe_set_alg</a></div><div class="ttdeci">int r_jwe_set_alg(jwe_t *jwe, jwa_alg alg)</div><div class="ttdef"><b>Definition:</b> jwe.c:3022</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md44"></a>
Compressed payload</h3>
<p>The header value <code>"zip":"DEF"</code> is used to specify if the JWE payload is compressed using <a href="https://tools.ietf.org/html/rfc7516#section-4.1.3">ZIP/Deflate</a> algorithm. Rhonabwy will automatically compress or decompress the decrypted payload during encryption or decryption process.</p>
<h2><a class="anchor" id="autotoc_md45"></a>
Parse and decrypt a JWE using Rhonabwy</h2>
<p>The JWE above can be parsed and verified using the following sample code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rhonabwy_8h.html">rhonabwy.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="structjwe__t.html">jwe_t</a> * jwe = NULL;</div>
<div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_key_rsa = NULL;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> jwk_pirvkey_rsa_str[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;RSA\&quot;,\&quot;n\&quot;:\&quot;0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx4cbbfAAtVT86zwu1RK7aPFFxuhDR1L6tSoc_BJECPebWKR&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;XjBZCiFV4n3oknjhMstn64tZ_2W-5JsGY4Hc5n9yBXArwl93lqt7_RN5w6Cf0h4QyQ5v-65YGjQR0_FDW2QvzqY368QQMicAtaSqzs8KJZgnYb9c7d0zgdAZHz&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;u6qMQvRL5hajrn1n91CbOpbISD08qNLyrdkt-bFTWhAI4vMQFh6WeZu0fM4lFd2NcRwr3XPksINHaQ-G_xBniIqbw0Ls1jF44-csFCur-kEgU8awapJzKnqDKg&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;w\&quot;,\&quot;e\&quot;:\&quot;AQAB\&quot;,\&quot;d\&quot;:\&quot;X4cTteJY_gn4FYPsXB8rdXix5vwsg1FLN5E3EaG6RJoVH-HLLKD9M7dx5oo7GURknchnrRweUkC7hT5fJLM0WbFAKNLWY2v&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;v7B6NqXSzUvxT0_YSfqijwp3RTzlBaCxWp4doFk5N2o8Gy_nHNKroADIkJ46pRUohsXywbReAdYaMwFs9tv8d_cPVY3i07a3t8MN6TNwm0dSawm9v47UiCl3Sk&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;5ZiG7xojPLu4sbg1U2jx4IBTNBznbJSzFHK66jT8bgkuqsk0GjskDJk19Z4qwjwbsnn4j2WBii3RL-Us2lGVkY8fkFzme1z0HbIkfz0Y6mqnOYtqc0X4jfcKoA&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;C8Q\&quot;,\&quot;p\&quot;:\&quot;83i-7IvMGXoMXCskv73TKr8637FiO7Z27zv8oj6pbWUQyLPQBQxtPVnwD20R-60eTDmD2ujnMt5PoqMrm8RfmNhVWDtjjMmCMjOpSXicFHj7&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;XOuVIYQyqVWlWEh6dN36GVZYk93N8Bc9vY41xy8B9RzzOGVQzXvNEvn7O0nVbfs\&quot;,\&quot;q\&quot;:\&quot;3dfOR9cuYq-0S-mkFLzgItgMEfFzB2q3hWehMuG0oCuqnb3v&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;obLyumqjVZQO1dIrdwgTnCdpYzBcOfW5r370AFXjiWft_NGEiovonizhKpo9VVS78TzFgxkIdrecRezsZ-1kYd_s1qDbxtkDEgfAITAG9LUnADun4vIcb6yelx&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;k\&quot;,\&quot;dp\&quot;:\&quot;G4sPXkc6Ya9y8oJW9_ILj4xuppu0lzi_H7VTkS8xj5SdX3coE0oimYwxIi2emTAue0UOa5dpgFGyBJ4c8tQ2VF402XRugKDTP8akYhFo5tAA7&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;7Qe_NmtuYZc3C3m3I24G2GvR5sSDxUyAN2zq8Lfn9EUms6rY3Ob8YeiKkTiBj0\&quot;,\&quot;dq\&quot;:\&quot;s9lAH9fggBsoFR8Oac2R_E2gw282rT2kGOAhvIllETE1efrA&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;6huUUvMfBcMpn8lqeW6vzznYY5SSQF7pMdC_agI3nG8Ibp1BUb0JUiraRNqUfLhcQb_d9GF4Dh7e74WbRsobRonujTYN1xCaP6TO61jvWrX-L18txXw494Q_cg&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;k\&quot;,\&quot;qi\&quot;:\&quot;GyM_p6JrXySiz1toFgKbWV-JdI3jQ4ypu9rbMWx3rQJBfmt0FoYzgUIZEVFEcOqwemRN81zoDAaa-Bk0KWNGDjJHZDdDmFhW3AN7lI-puxk_m&quot;</span>\</div>
<div class="line">                                   <span class="stringliteral">&quot;HZGJ11rxyR8O55XLSe3SPmRfKwZI6yU24ZxvQKFYItdldUKGzO6Ia6zTKhAVRU\&quot;,\&quot;alg\&quot;:\&quot;RS256\&quot;,\&quot;kid\&quot;:\&quot;2011-04-29\&quot;}&quot;</span>,</div>
<div class="line">token[] = <span class="stringliteral">&quot;eyJhbGciOiJSU0ExXzUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.0ouvmluqT8kvBCgjMw8mhBFFEI5Rua58WnnATU21RqEQ2f9M6FqGEkgYpJ81ePtTkOyW1l8V-4nxIDxy-xeTHd0v5bDEbxhWKRdOmUHACC018Gt1ZB9EHHJt7k4UYj3up2xVa8qykKbZ3WGF0Gffi6ctfLCfRCWNnXMbAylV02mf4Tfhpad_WC4EeZENNryilXbAKD_9NNje-CoXD0IQK4-z2fkzfyUislwzK7dyz--uNNAC3N6XO3Blr_z61wXWGEHBa62fyHCsQqagAzN_MqTZv6cxOpRpeWM4_SwjjvcyC77rRyVpN0lC9ukyX_pNrGLXW8zH4mH78OcKPoDLPw.o5e-xb5ZzvZA2JYD2qgFbA.YNTPRS7Hv0fqE7ReEUAS_KNM31wMPPldhBGmYuQTzUWVcX8pGqooTbwaV4o_7BBiF4apD_VCGWwQ-fDD0eDofg.uyAjCu7WSo8BeBDFmYfkLA&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * payload = NULL;</div>
<div class="line"><span class="keywordtype">size_t</span> payload_len = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__core.html#gaf6734cc4f9ab69d875ff86d60aee3c06">r_jwk_init</a>(&amp;jwk_key_rsa) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__core.html#ga9fe136eb9a9a8c256f4cdb091c14da52">r_jwe_init</a>(&amp;jwe) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__import.html#ga19c4a32dc17dc0c11a452b177c83b1aa">r_jwk_import_from_json_str</a>(jwk_key_rsa, jwk_pirvkey_rsa_str) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    <a class="code" href="group__jwe.html#ga48fc5ee3b222f9c17032058a2f94f780">r_jwe_parse</a>(jwe, token, 0) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp;</div>
<div class="line">    <a class="code" href="group__jwe.html#gab8e95565dde6e0b1f751b7e89c4eeb4a">r_jwe_decrypt</a>(jwe, jwk_key_rsa, 0) == <a class="code" href="group__const.html#ga3fc690cb1d601c13fce959aff60de0d7">RHN_OK</a> &amp;&amp; </div>
<div class="line">    (payload = <a class="code" href="group__jwe.html#ga05b3ef9b5b34328128d4671df3fe4c13">r_jwe_get_payload</a>(jwe, &amp;payload_len)) != NULL &amp;&amp; payload_len &gt; 0) {</div>
<div class="line">  <span class="comment">// payload and payload_len will contain the payload data</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__core.html#ga14172c6cf13d0e96abf27d660d87037b">r_jwe_free</a>(jwe);</div>
<div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_key_rsa);</div>
<div class="ttc" id="agroup__jwe_html_ga05b3ef9b5b34328128d4671df3fe4c13"><div class="ttname"><a href="group__jwe.html#ga05b3ef9b5b34328128d4671df3fe4c13">r_jwe_get_payload</a></div><div class="ttdeci">const unsigned char * r_jwe_get_payload(jwe_t *jwe, size_t *payload_len)</div><div class="ttdef"><b>Definition:</b> jwe.c:2818</div></div>
<div class="ttc" id="agroup__jwe_html_ga48fc5ee3b222f9c17032058a2f94f780"><div class="ttname"><a href="group__jwe.html#ga48fc5ee3b222f9c17032058a2f94f780">r_jwe_parse</a></div><div class="ttdeci">int r_jwe_parse(jwe_t *jwe, const char *jwe_str, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwe.c:3766</div></div>
<div class="ttc" id="agroup__jwe_html_gab8e95565dde6e0b1f751b7e89c4eeb4a"><div class="ttname"><a href="group__jwe.html#gab8e95565dde6e0b1f751b7e89c4eeb4a">r_jwe_decrypt</a></div><div class="ttdeci">int r_jwe_decrypt(jwe_t *jwe, jwk_t *jwk_privkey, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwe.c:4092</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md46"></a>
ECDH-ES implementation</h2>
<p>The ECDH-ES algorithm requires an ECC or ECDH public key for the encryption. The RFC specifies `"A new ephemeral public key value MUST be generated for each key agreement operation.", so an ephemeral key is genererated on each encryption.</p>
<p>You can specify the ephemeral key to use though, by setting an encryption key to the JWE before generating the token. The responsibilty not to reuse the same ephemeral key is yours then.</p>
<p>Example with a specified ephemeral key:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> payload[] = <span class="stringliteral">&quot;The true sign of intelligence is not knowledge but imagination...&quot;</span>;</div>
<div class="line"><span class="comment">// This is the ephemeral key</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> eph[] = <span class="stringliteral">&quot; {\&quot;kty\&quot;:\&quot;EC\&quot;,\&quot;crv\&quot;:\&quot;P-256\&quot;,\&quot;x\&quot;:\&quot;gI0GAILBdu7T53akrFmMyGcsF3n5dO7MmwNBHKW5SV0\&quot;,&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;\&quot;y\&quot;:\&quot;SLW_xSffzlPWrHEVI30DHM_4egVwt3NQqeUD7nMFpps\&quot;,\&quot;d\&quot;:\&quot;0_NxaRPUMQoAJt50Gz8YiTr8gRTwyEaCumd-MToTmIo\&quot;}&quot;</span>,</div>
<div class="line">bob[] = <span class="stringliteral">&quot;{\&quot;kty\&quot;:\&quot;EC\&quot;,\&quot;crv\&quot;:\&quot;P-256\&quot;,\&quot;x\&quot;:\&quot;weNJy2HscCSM6AEDTDg04biOvhFhyyWvOHQfeF_PxMQ\&quot;,&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;\&quot;y\&quot;:\&quot;e8lnCO-AlStT-NJVX-crhB7QRYhiix03illJOVAOyck\&quot;}&quot;</span>; <span class="comment">// This is the public key</span></div>
<div class="line"><a class="code" href="group__type.html#gac7d996dfabdc443bcd0da0b6574e22ef">jwk_t</a> * jwk_eph = NULL, * jwk_bob = NULL;</div>
<div class="line"><a class="code" href="structjwe__t.html">jwe_t</a> * jwe = NULL;</div>
<div class="line"><span class="keywordtype">char</span> * token;</div>
<div class="line"> </div>
<div class="line">jwk_eph = <a class="code" href="group__import.html#ga44fa1b37eb402aefe9cf7dd3fb8fbd1d">r_jwk_quick_import</a>(<a class="code" href="group__type.html#gga7ac7039b8e1cc414d3da273c244ed591a4a3332067652c1a8940839b8562841aa">R_IMPORT_JSON_STR</a>, eph);</div>
<div class="line">jwk_bob = <a class="code" href="group__import.html#ga44fa1b37eb402aefe9cf7dd3fb8fbd1d">r_jwk_quick_import</a>(<a class="code" href="group__type.html#gga7ac7039b8e1cc414d3da273c244ed591a4a3332067652c1a8940839b8562841aa">R_IMPORT_JSON_STR</a>, bob);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__core.html#ga9fe136eb9a9a8c256f4cdb091c14da52">r_jwe_init</a>(&amp;jwe);</div>
<div class="line"><a class="code" href="group__jwe.html#ga31e487c9e934bfe7a988cebcf6d24dc9">r_jwe_set_payload</a>(jwe, payload, <span class="keyword">sizeof</span>(payload));</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__jwe.html#ga7f718031ee9be3799d85a35805a48c0d">r_jwe_add_keys</a>(jwe, jwk_eph, jwk_bob); <span class="comment">// Add both public and ephemeral keys here</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__jwe.html#ga4970779790d672fee843abd87c0df229">r_jwe_set_alg</a>(jwe, <a class="code" href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaacfbcb86ffd4abdcb76192bd625d33c49">R_JWA_ALG_ECDH_ES_A128KW</a>);</div>
<div class="line"><a class="code" href="group__jwe.html#ga326f844d28010d3e7396f913a34e26fb">r_jwe_set_enc</a>(jwe, <a class="code" href="group__type.html#gga34a92d88d5befd0170a6b82ec53ef020a449007d1ef57dd34cf5d7c28070d5fc2">R_JWA_ENC_A128GCM</a>);</div>
<div class="line"><a class="code" href="group__jwe.html#gae9c4c9802a7b8ff6712de7031cb6872d">r_jwe_set_header_str_value</a>(jwe, <span class="stringliteral">&quot;apu&quot;</span>, <span class="stringliteral">&quot;QWxpY2U&quot;</span>);</div>
<div class="line"><a class="code" href="group__jwe.html#gae9c4c9802a7b8ff6712de7031cb6872d">r_jwe_set_header_str_value</a>(jwe, <span class="stringliteral">&quot;apv&quot;</span>, <span class="stringliteral">&quot;Qm9i&quot;</span>);</div>
<div class="line"> </div>
<div class="line">token = <a class="code" href="group__jwe.html#gae9d1ad8e969eb23794dcce3f78a1aa1f">r_jwe_serialize</a>(jwe, NULL, 0); <span class="comment">// token will contain the compact representation of the serialized token, e.g. eyJhcHUiOiJRV3hwWTJVIiwiYXB2IjoiUW0[...]</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__core.html#gab04b1ac2dfe5a33b0aae918f9d17b359">r_free</a>(token);</div>
<div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_eph);</div>
<div class="line"><a class="code" href="group__core.html#ga5132358e821050897ea7e65b0a6e324b">r_jwk_free</a>(jwk_bob);</div>
<div class="line"><a class="code" href="group__core.html#ga14172c6cf13d0e96abf27d660d87037b">r_jwe_free</a>(jwe);</div>
<div class="ttc" id="agroup__jwe_html_ga7f718031ee9be3799d85a35805a48c0d"><div class="ttname"><a href="group__jwe.html#ga7f718031ee9be3799d85a35805a48c0d">r_jwe_add_keys</a></div><div class="ttdeci">int r_jwe_add_keys(jwe_t *jwe, jwk_t *jwk_privkey, jwk_t *jwk_pubkey)</div><div class="ttdef"><b>Definition:</b> jwe.c:3158</div></div>
<div class="ttc" id="agroup__jwe_html_gae9c4c9802a7b8ff6712de7031cb6872d"><div class="ttname"><a href="group__jwe.html#gae9c4c9802a7b8ff6712de7031cb6872d">r_jwe_set_header_str_value</a></div><div class="ttdeci">int r_jwe_set_header_str_value(jwe_t *jwe, const char *key, const char *str_value)</div><div class="ttdef"><b>Definition:</b> jwe.c:3064</div></div>
<div class="ttc" id="agroup__type_html_gga7ac7039b8e1cc414d3da273c244ed591a4a3332067652c1a8940839b8562841aa"><div class="ttname"><a href="group__type.html#gga7ac7039b8e1cc414d3da273c244ed591a4a3332067652c1a8940839b8562841aa">R_IMPORT_JSON_STR</a></div><div class="ttdeci">@ R_IMPORT_JSON_STR</div><div class="ttdoc">Import from a stringified JSON, following parameter must be a const char * value.</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:230</div></div>
<div class="ttc" id="agroup__type_html_ggaaf028013558b5ff9aa99ff4afc3ae2eaacfbcb86ffd4abdcb76192bd625d33c49"><div class="ttname"><a href="group__type.html#ggaaf028013558b5ff9aa99ff4afc3ae2eaacfbcb86ffd4abdcb76192bd625d33c49">R_JWA_ALG_ECDH_ES_A128KW</a></div><div class="ttdeci">@ R_JWA_ALG_ECDH_ES_A128KW</div><div class="ttdef"><b>Definition:</b> rhonabwy.h:141</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md47"></a>
Tokens in JSON format</h1>
<p>Rhonabwy supports serializing and parsing tokens in JSON format, see <a href="https://datatracker.ietf.org/doc/html/rfc7516#section-7.2">JWE JSON Serialization</a> and <a href="https://datatracker.ietf.org/doc/html/rfc7515#section-7.2">JWS JSON Serialization</a>.</p>
<h2><a class="anchor" id="autotoc_md48"></a>
JWS JSON serialization and parsing</h2>
<p>To serialize a JWS in JSON format, you must use the functions <code>r_jws_serialize_json_t</code> or <code>r_jws_serialize_json_str</code>, the parameter <code>mode</code> must have the value <code>R_JSON_MODE_GENERAL</code> to serialize in general format (allows multiple signatures), or <code>R_JSON_MODE_FLATTENED</code> to serialize in flattened format.</p>
<p>To parse a JWS in JSON format, you can either use <code>r_jws_parse_json_str</code>, <code>r_jws_parsen_json_str</code> or <code>r_jws_parse_json_t</code> when you know the token is in JSON format, or you can use <code>r_jws_parse</code> or <code>r_jws_parsen</code>.</p>
<p>If the token is in general JSON format and has multiple signatures, the function <code>r_jws_verify_signature</code> will return <code>RHN_OK</code> if one of the signatures is verified by the public key specified or one of the public keys added to its public JWKS.</p>
<h2><a class="anchor" id="autotoc_md49"></a>
JWE JSON serialization and parsing</h2>
<p>To serialize a JWE in JSON format, you must use the functions <code>r_jwe_serialize_json_t</code> or <code>r_jwe_serialize_json_str</code>, the parameter <code>mode</code> must have the value <code>R_JSON_MODE_GENERAL</code> to serialize in general format (allows multiple key encryption), or <code>R_JSON_MODE_FLATTENED</code> to serialize in flattened format.</p>
<p>To parse a JWE in JSON format, you can either use <code>r_jwe_parse_json_str</code>, <code>r_jwe_parsen_json_str</code> or <code>r_jwe_parse_json_t</code> when you know the token is in JSON format, or you can use <code>r_jwe_parse</code> or <code>r_jwe_parsen</code>.</p>
<p>If the token is in general JSON format and has multiple key encryption, the function <code>r_jwe_decrypt</code> will decrypt the payload and return <code>RHN_OK</code> if one of the recipients content is correctly decrypted using a specified private key or one of the private key added to its private JWKS.</p>
<h2><a class="anchor" id="autotoc_md50"></a>
Quick parsing</h2>
<p>The quick parsing functions can be used to parse a JWE in one line:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><a class="code" href="structjwe__t.html">jwe_t</a> * <a class="code" href="group__jwe.html#ga115c5ee5849ce5fa2c07aa0cf285e58d">r_jwe_quick_parse</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * jwe_str, uint32_t parse_flags, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="structjwe__t.html">jwe_t</a> * <a class="code" href="group__jwe.html#gab8644934875b999b5b7b1d3eb4e23b6f">r_jwe_quick_parsen</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * jwe_str, <span class="keywordtype">size_t</span> jwe_str_len, uint32_t parse_flags, <span class="keywordtype">int</span> x5u_flags);</div>
<div class="ttc" id="agroup__jwe_html_ga115c5ee5849ce5fa2c07aa0cf285e58d"><div class="ttname"><a href="group__jwe.html#ga115c5ee5849ce5fa2c07aa0cf285e58d">r_jwe_quick_parse</a></div><div class="ttdeci">jwe_t * r_jwe_quick_parse(const char *jwe_str, uint32_t parse_flags, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwe.c:4071</div></div>
<div class="ttc" id="agroup__jwe_html_gab8644934875b999b5b7b1d3eb4e23b6f"><div class="ttname"><a href="group__jwe.html#gab8644934875b999b5b7b1d3eb4e23b6f">r_jwe_quick_parsen</a></div><div class="ttdeci">jwe_t * r_jwe_quick_parsen(const char *jwe_str, size_t jwe_str_len, uint32_t parse_flags, int x5u_flags)</div><div class="ttdef"><b>Definition:</b> jwe.c:4075</div></div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
